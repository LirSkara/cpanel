import{d as is,u as ns,r,c as E,o as rs,a as us,b as c,e as s,f as y,g as ds,w as vs,h as cs,i as u,t as d,j as a,v,k as D,F as ps,l as bs,m as k,n as R,p as _,q as p,s as f,_ as ms}from"./index-BRWVB6f9.js";const fs={class:"users-management-page pt-2"},ys={class:"page-header"},gs={class:"breadcrumb"},ws={class:"header-content"},ks={class:"header-left"},_s={class:"page-subtitle"},Us={class:"badge bg-primary"},xs={class:"badge bg-success"},Cs={class:"badge bg-warning"},hs={class:"header-right"},Vs=["disabled"],As={class:"filters-section"},Ms={class:"filters-content"},qs={class:"search-box"},Fs={class:"filter-controls"},Ss={class:"users-table-section"},Is={class:"table-container"},Ps={key:0,class:"loading-state"},Es={key:1,class:"empty-state"},Ds={key:2,class:"users-table"},Ls={class:"user-info"},Ns={class:"user-avatar"},$s={class:"user-details"},Bs={class:"user-name"},Rs={class:"user-username"},Ts={key:0,class:"user-phone"},js={key:1,class:"user-last-login"},zs={class:"user-role"},Qs={class:"user-status"},Gs={class:"user-shift"},Hs={class:"user-created"},Js={class:"user-actions"},Ks={class:"actions-menu"},Os=["onClick"],Ws=["onClick"],Xs=["onClick","title"],Ys=["onClick","disabled"],Zs={key:0,class:"validation-errors"},se={class:"form-group"},ee={class:"form-group"},le={class:"form-group"},te={class:"form-group"},oe={class:"form-group"},ae={class:"form-group"},ie={class:"form-group"},ne={class:"form-group"},re={class:"form-checkbox"},ue={class:"form-actions"},de=["disabled"],ve={key:0,class:"validation-errors"},ce={class:"form-group"},pe={class:"form-group"},be={class:"form-group"},me={class:"form-group"},fe={class:"form-group"},ye={class:"form-group"},ge={class:"form-group"},we={class:"form-checkbox"},ke={class:"form-group"},_e={class:"form-checkbox"},Ue={class:"form-actions"},xe=["disabled"],Ce={class:"form-group"},he={class:"form-group"},Ve={class:"form-actions"},Ae=["disabled"],Me=is({__name:"UsersManagementView",setup(qe){const G=us(),T=ns(),o=r([]),V=r(!1),U=r(""),x=r(""),C=r(""),L=r(!1),N=r(!1),$=r(!1),n=r({username:"",password:"",full_name:"",role:"waiter",is_active:!0,phone:"",passport:"",pin_code:""}),A=r(!1),g=r(""),i=r({}),h=r(null),M=r(!1),w=r(""),b=r({new_password:"",confirm_password:""}),q=r(null),F=r(!1),j=E(()=>T.user),H=E(()=>Array.isArray(o.value)?o.value.filter(t=>t.is_active).length:0),J=E(()=>Array.isArray(o.value)?o.value.filter(t=>t.shift_active).length:0),z=E(()=>{if(!Array.isArray(o.value))return[];let t=o.value;if(U.value){const e=U.value.toLowerCase();t=t.filter(m=>m.full_name.toLowerCase().includes(e)||m.username.toLowerCase().includes(e))}return x.value&&(t=t.filter(e=>e.role===x.value)),C.value==="active"?t=t.filter(e=>e.is_active):C.value==="inactive"&&(t=t.filter(e=>!e.is_active)),t}),K=t=>{switch(t){case"admin":return"bi bi-shield-fill-check";case"waiter":return"bi bi-person-badge";case"kitchen":return"bi bi-cup-hot";default:return"bi bi-person"}},O=t=>{switch(t){case"admin":return"Администратор";case"waiter":return"Официант";case"kitchen":return"Кухня";default:return t}},W=t=>{switch(t){case"admin":return"role-badge admin";case"waiter":return"role-badge waiter";case"kitchen":return"role-badge kitchen";default:return"role-badge"}},Q=t=>new Date(t).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"}),X=async()=>{try{V.value=!0;const t=await _.getUsers();t&&Array.isArray(t.users)?o.value=t.users:(console.error("API returned unexpected data format:",t),o.value=[])}catch(t){console.error("Failed to load users:",t),o.value=[]}finally{V.value=!1}},Y=()=>{U.value="",x.value="",C.value=""},S=()=>{L.value=!1,g.value="",n.value={username:"",password:"",full_name:"",role:"waiter",is_active:!0,phone:"",passport:"",pin_code:""}},Z=async()=>{try{A.value=!0,g.value="";const t=await _.createUser(n.value);Array.isArray(o.value)?o.value.push(t):o.value=[t],S()}catch(t){console.error("Failed to create user:",t),t instanceof Error?g.value=t.message:g.value="Произошла неизвестная ошибка"}finally{A.value=!1}},ss=t=>{h.value=t.id,i.value={username:t.username,full_name:t.full_name,role:t.role,is_active:t.is_active,shift_active:t.shift_active,phone:t.phone||"",passport:t.passport||"",pin_code:t.pin_code||""},N.value=!0},I=()=>{N.value=!1,w.value="",i.value={},h.value=null},es=async()=>{if(!(!h.value||!Array.isArray(o.value)))try{M.value=!0,w.value="";const t=await _.updateUser(h.value,i.value),e=o.value.findIndex(m=>m.id===h.value);e!==-1&&(o.value[e]=t),I()}catch(t){console.error("Failed to update user:",t),t instanceof Error?w.value=t.message:w.value="Произошла неизвестная ошибка"}finally{M.value=!1}},ls=t=>{q.value=t.id,b.value={new_password:"",confirm_password:""},$.value=!0},P=()=>{$.value=!1,b.value={new_password:"",confirm_password:""},q.value=null},ts=async()=>{if(q.value){if(b.value.new_password!==b.value.confirm_password){alert("Пароли не совпадают");return}try{F.value=!0,await _.changeUserPassword(q.value,b.value),P()}catch(t){console.error("Failed to change password:",t)}finally{F.value=!1}}},os=async t=>{if(Array.isArray(o.value))try{const e=await _.updateUser(t.id,{is_active:!t.is_active}),m=o.value.findIndex(l=>l.id===t.id);m!==-1&&(o.value[m]=e)}catch(e){console.error("Failed to toggle user status:",e)}},as=async t=>{if(Array.isArray(o.value)){if(t.id===j.value?.id){alert("Нельзя удалить самого себя");return}if(confirm(`Вы уверены, что хотите удалить пользователя "${t.full_name}"?`))try{await _.deleteUser(t.id),o.value=o.value.filter(e=>e.id!==t.id)}catch(e){console.error("Failed to delete user:",e)}}};return rs(async()=>{if(!T.isAuthenticated){G.push("/login");return}await X()}),(t,e)=>{const m=cs("router-link");return p(),c("div",fs,[s("div",ys,[s("nav",gs,[ds(m,{to:"/dashboard",class:"breadcrumb-item"},{default:vs(()=>e[25]||(e[25]=[s("i",{class:"bi bi-house"},null,-1),u(" Главная ")])),_:1,__:[25]}),e[26]||(e[26]=s("span",{class:"breadcrumb-separator"},"/",-1)),e[27]||(e[27]=s("span",{class:"breadcrumb-item active"},"Управление пользователями",-1))]),s("div",ws,[s("div",ks,[e[31]||(e[31]=s("h1",{class:"page-title"},[s("i",{class:"bi bi-people-fill"}),u(" Управление пользователями ")],-1)),s("p",_s,[e[28]||(e[28]=u(" Всего пользователей: ")),s("span",Us,d(Array.isArray(o.value)?o.value.length:0),1),e[29]||(e[29]=u(" • Активных: ")),s("span",xs,d(H.value),1),e[30]||(e[30]=u(" • На смене: ")),s("span",Cs,d(J.value),1)])]),s("div",hs,[s("button",{onClick:e[0]||(e[0]=l=>L.value=!0),class:"btn btn-primary",disabled:V.value},e[32]||(e[32]=[s("i",{class:"bi bi-plus-circle"},null,-1),u(" Добавить пользователя ")]),8,Vs)])])]),s("div",As,[s("div",Ms,[s("div",qs,[e[33]||(e[33]=s("i",{class:"bi bi-search"},null,-1)),a(s("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>U.value=l),type:"text",placeholder:"Поиск по имени или логину...",class:"search-input"},null,512),[[v,U.value]])]),s("div",Fs,[a(s("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>x.value=l),class:"filter-select"},e[34]||(e[34]=[s("option",{value:""},"Все роли",-1),s("option",{value:"admin"},"Администратор",-1),s("option",{value:"waiter"},"Официант",-1),s("option",{value:"kitchen"},"Кухня",-1)]),512),[[D,x.value]]),a(s("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>C.value=l),class:"filter-select"},e[35]||(e[35]=[s("option",{value:""},"Все статусы",-1),s("option",{value:"active"},"Активные",-1),s("option",{value:"inactive"},"Неактивные",-1)]),512),[[D,C.value]]),s("button",{onClick:Y,class:"btn btn-outline-secondary"},e[36]||(e[36]=[s("i",{class:"bi bi-arrow-clockwise"},null,-1),u(" Сбросить ")]))])])]),s("div",Ss,[s("div",Is,[V.value?(p(),c("div",Ps,e[37]||(e[37]=[s("div",{class:"spinner-border",role:"status"},[s("span",{class:"visually-hidden"},"Загрузка...")],-1),s("p",null,"Загрузка пользователей...",-1)]))):z.value.length===0?(p(),c("div",Es,e[38]||(e[38]=[s("div",{class:"empty-icon"},[s("i",{class:"bi bi-person-x"})],-1),s("h3",null,"Пользователи не найдены",-1),s("p",null,"Попробуйте изменить параметры поиска или добавить нового пользователя",-1)]))):(p(),c("table",Ds,[e[42]||(e[42]=s("thead",null,[s("tr",null,[s("th",null,"Пользователь"),s("th",null,"Роль"),s("th",null,"Статус"),s("th",null,"Смена"),s("th",null,"Создан"),s("th",null,"Действия")])],-1)),s("tbody",null,[(p(!0),c(ps,null,bs(z.value,l=>(p(),c("tr",{key:l.id,class:"user-row"},[s("td",Ls,[s("div",Ns,[s("i",{class:f(K(l.role))},null,2)]),s("div",$s,[s("div",Bs,d(l.full_name),1),s("div",Rs,"@"+d(l.username),1),l.phone?(p(),c("div",Ts,d(l.phone),1)):y("",!0),l.last_login?(p(),c("div",js," Последний вход: "+d(Q(l.last_login)),1)):y("",!0)])]),s("td",zs,[s("span",{class:f(W(l.role))},d(O(l.role)),3)]),s("td",Qs,[s("span",{class:f(l.is_active?"status-badge active":"status-badge inactive")},[s("i",{class:f(l.is_active?"bi bi-check-circle":"bi bi-x-circle")},null,2),u(" "+d(l.is_active?"Активен":"Неактивен"),1)],2)]),s("td",Gs,[s("span",{class:f(l.shift_active?"status-badge shift-on":"status-badge shift-off")},[s("i",{class:f(l.shift_active?"bi bi-clock-fill":"bi bi-clock")},null,2),u(" "+d(l.shift_active?"На смене":"Не на смене"),1)],2)]),s("td",Hs,d(Q(l.created_at)),1),s("td",Js,[s("div",Ks,[s("button",{onClick:B=>ss(l),class:"action-btn edit",title:"Редактировать"},e[39]||(e[39]=[s("i",{class:"bi bi-pencil"},null,-1)]),8,Os),s("button",{onClick:B=>ls(l),class:"action-btn password",title:"Сменить пароль"},e[40]||(e[40]=[s("i",{class:"bi bi-key"},null,-1)]),8,Ws),s("button",{onClick:B=>os(l),class:f(l.is_active?"action-btn disable":"action-btn enable"),title:l.is_active?"Деактивировать":"Активировать"},[s("i",{class:f(l.is_active?"bi bi-person-x":"bi bi-person-check")},null,2)],10,Xs),s("button",{onClick:B=>as(l),class:"action-btn delete",title:"Удалить",disabled:l.id===j.value?.id},e[41]||(e[41]=[s("i",{class:"bi bi-trash"},null,-1)]),8,Ys)])])]))),128))])]))])]),L.value?(p(),c("div",{key:0,class:"modal-overlay",onClick:S},[s("div",{class:"modal-content",onClick:e[12]||(e[12]=k(()=>{},["stop"]))},[s("div",{class:"modal-header"},[e[44]||(e[44]=s("h3",{class:"modal-title"},[s("i",{class:"bi bi-person-plus"}),u(" Добавить пользователя ")],-1)),s("button",{onClick:S,class:"modal-close"},e[43]||(e[43]=[s("i",{class:"bi bi-x"},null,-1)]))]),g.value?(p(),c("div",Zs,[s("pre",null,d(g.value),1)])):y("",!0),s("form",{onSubmit:k(Z,["prevent"]),class:"user-form"},[s("div",se,[e[45]||(e[45]=s("label",{class:"form-label"},"Полное имя",-1)),a(s("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.full_name=l),type:"text",class:"form-control",required:"",placeholder:"Иван Иванов"},null,512),[[v,n.value.full_name]])]),s("div",ee,[e[46]||(e[46]=s("label",{class:"form-label"},"Логин",-1)),a(s("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.username=l),type:"text",class:"form-control",required:"",placeholder:"ivan_ivanov"},null,512),[[v,n.value.username]])]),s("div",le,[e[47]||(e[47]=s("label",{class:"form-label"},"Пароль",-1)),a(s("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.password=l),type:"password",class:"form-control",required:"",placeholder:"••••••••"},null,512),[[v,n.value.password]])]),s("div",te,[e[49]||(e[49]=s("label",{class:"form-label"},"Роль",-1)),a(s("select",{"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.role=l),class:"form-control",required:""},e[48]||(e[48]=[s("option",{value:""},"Выберите роль",-1),s("option",{value:"admin"},"Администратор",-1),s("option",{value:"waiter"},"Официант",-1),s("option",{value:"kitchen"},"Кухня",-1)]),512),[[D,n.value.role]])]),s("div",oe,[e[50]||(e[50]=s("label",{class:"form-label"},"Телефон",-1)),a(s("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.phone=l),type:"tel",class:"form-control",placeholder:"+7 (999) 123-45-67"},null,512),[[v,n.value.phone]])]),s("div",ae,[e[51]||(e[51]=s("label",{class:"form-label"},"Паспорт",-1)),a(s("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>n.value.passport=l),type:"text",class:"form-control",placeholder:"1234 567890"},null,512),[[v,n.value.passport]])]),s("div",ie,[e[52]||(e[52]=s("label",{class:"form-label"},"PIN-код",-1)),a(s("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>n.value.pin_code=l),type:"text",class:"form-control",placeholder:"1234",maxlength:"4"},null,512),[[v,n.value.pin_code]])]),s("div",ne,[s("label",re,[a(s("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>n.value.is_active=l),type:"checkbox"},null,512),[[R,n.value.is_active]]),e[53]||(e[53]=s("span",{class:"checkbox-mark"},null,-1)),e[54]||(e[54]=u(" Активен "))])]),s("div",ue,[s("button",{type:"button",onClick:S,class:"btn btn-secondary"}," Отмена "),s("button",{type:"submit",class:"btn btn-primary",disabled:A.value},[e[55]||(e[55]=s("i",{class:"bi bi-plus-circle"},null,-1)),u(" "+d(A.value?"Создание...":"Создать"),1)],8,de)])],32)])])):y("",!0),N.value?(p(),c("div",{key:1,class:"modal-overlay",onClick:I},[s("div",{class:"modal-content",onClick:e[21]||(e[21]=k(()=>{},["stop"]))},[s("div",{class:"modal-header"},[e[57]||(e[57]=s("h3",{class:"modal-title"},[s("i",{class:"bi bi-pencil"}),u(" Редактировать пользователя ")],-1)),s("button",{onClick:I,class:"modal-close"},e[56]||(e[56]=[s("i",{class:"bi bi-x"},null,-1)]))]),w.value?(p(),c("div",ve,[s("pre",null,d(w.value),1)])):y("",!0),s("form",{onSubmit:k(es,["prevent"]),class:"user-form"},[s("div",ce,[e[58]||(e[58]=s("label",{class:"form-label"},"Полное имя",-1)),a(s("input",{"onUpdate:modelValue":e[13]||(e[13]=l=>i.value.full_name=l),type:"text",class:"form-control",required:""},null,512),[[v,i.value.full_name]])]),s("div",pe,[e[59]||(e[59]=s("label",{class:"form-label"},"Логин",-1)),a(s("input",{"onUpdate:modelValue":e[14]||(e[14]=l=>i.value.username=l),type:"text",class:"form-control",required:""},null,512),[[v,i.value.username]])]),s("div",be,[e[61]||(e[61]=s("label",{class:"form-label"},"Роль",-1)),a(s("select",{"onUpdate:modelValue":e[15]||(e[15]=l=>i.value.role=l),class:"form-control",required:""},e[60]||(e[60]=[s("option",{value:"admin"},"Администратор",-1),s("option",{value:"waiter"},"Официант",-1),s("option",{value:"kitchen"},"Кухня",-1)]),512),[[D,i.value.role]])]),s("div",me,[e[62]||(e[62]=s("label",{class:"form-label"},"Телефон",-1)),a(s("input",{"onUpdate:modelValue":e[16]||(e[16]=l=>i.value.phone=l),type:"tel",class:"form-control",placeholder:"+7 (999) 123-45-67"},null,512),[[v,i.value.phone]])]),s("div",fe,[e[63]||(e[63]=s("label",{class:"form-label"},"Паспорт",-1)),a(s("input",{"onUpdate:modelValue":e[17]||(e[17]=l=>i.value.passport=l),type:"text",class:"form-control",placeholder:"1234 567890"},null,512),[[v,i.value.passport]])]),s("div",ye,[e[64]||(e[64]=s("label",{class:"form-label"},"PIN-код",-1)),a(s("input",{"onUpdate:modelValue":e[18]||(e[18]=l=>i.value.pin_code=l),type:"text",class:"form-control",placeholder:"1234",maxlength:"4"},null,512),[[v,i.value.pin_code]])]),s("div",ge,[s("label",we,[a(s("input",{"onUpdate:modelValue":e[19]||(e[19]=l=>i.value.is_active=l),type:"checkbox"},null,512),[[R,i.value.is_active]]),e[65]||(e[65]=s("span",{class:"checkbox-mark"},null,-1)),e[66]||(e[66]=u(" Активен "))])]),s("div",ke,[s("label",_e,[a(s("input",{"onUpdate:modelValue":e[20]||(e[20]=l=>i.value.shift_active=l),type:"checkbox"},null,512),[[R,i.value.shift_active]]),e[67]||(e[67]=s("span",{class:"checkbox-mark"},null,-1)),e[68]||(e[68]=u(" На смене "))])]),s("div",Ue,[s("button",{type:"button",onClick:I,class:"btn btn-secondary"}," Отмена "),s("button",{type:"submit",class:"btn btn-primary",disabled:M.value},[e[69]||(e[69]=s("i",{class:"bi bi-check-circle"},null,-1)),u(" "+d(M.value?"Сохранение...":"Сохранить"),1)],8,xe)])],32)])])):y("",!0),$.value?(p(),c("div",{key:2,class:"modal-overlay",onClick:P},[s("div",{class:"modal-content",onClick:e[24]||(e[24]=k(()=>{},["stop"]))},[s("div",{class:"modal-header"},[e[71]||(e[71]=s("h3",{class:"modal-title"},[s("i",{class:"bi bi-key"}),u(" Смена пароля ")],-1)),s("button",{onClick:P,class:"modal-close"},e[70]||(e[70]=[s("i",{class:"bi bi-x"},null,-1)]))]),s("form",{onSubmit:k(ts,["prevent"]),class:"user-form"},[s("div",Ce,[e[72]||(e[72]=s("label",{class:"form-label"},"Новый пароль",-1)),a(s("input",{"onUpdate:modelValue":e[22]||(e[22]=l=>b.value.new_password=l),type:"password",class:"form-control",required:"",placeholder:"••••••••"},null,512),[[v,b.value.new_password]])]),s("div",he,[e[73]||(e[73]=s("label",{class:"form-label"},"Подтвердите пароль",-1)),a(s("input",{"onUpdate:modelValue":e[23]||(e[23]=l=>b.value.confirm_password=l),type:"password",class:"form-control",required:"",placeholder:"••••••••"},null,512),[[v,b.value.confirm_password]])]),s("div",Ve,[s("button",{type:"button",onClick:P,class:"btn btn-secondary"}," Отмена "),s("button",{type:"submit",class:"btn btn-primary",disabled:F.value},[e[74]||(e[74]=s("i",{class:"bi bi-key"},null,-1)),u(" "+d(F.value?"Изменение...":"Изменить пароль"),1)],8,Ae)])],32)])])):y("",!0)])}}}),Se=ms(Me,[["__scopeId","data-v-a1c6fc75"]]);export{Se as default};

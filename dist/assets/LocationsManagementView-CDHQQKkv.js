import{d as ut,u as vt,r,c as B,o as bt,a as mt,b as d,e as t,f,g as pt,w as ft,h as yt,i as n,t as i,j as m,k as gt,F as P,l as R,m as A,v as _,n as N,p as u,s as F,x as _t,q as c,_ as kt}from"./index-BRWVB6f9.js";const ht={class:"locations-page"},wt={class:"container-fluid py-4"},xt={class:"card shadow-sm border-0 mb-4 p-3"},Ct={class:"card-body"},Lt={"aria-label":"breadcrumb",class:"mb-3"},At={class:"breadcrumb mb-0"},Ft={class:"breadcrumb-item"},Vt={class:"row align-items-center"},$t={class:"col-md-8"},St={class:"text-muted mb-0"},Mt={class:"badge bg-primary"},Tt={class:"badge bg-success"},Ut={class:"badge bg-warning"},It={class:"col-md-4 text-end"},Dt={class:"btn-group"},Et=["disabled"],jt=["disabled"],zt={class:"container-fluid"},Bt={class:"row"},Nt={class:"col-12"},qt={class:"card shadow-sm border-0"},Pt={class:"card-header bg-white"},Rt={class:"row align-items-center"},Gt={class:"col-md-8"},Ht={class:"d-flex gap-2 align-items-center"},Jt={key:0,class:"btn-group btn-group-sm"},Kt=["title"],Ot=["title"],Qt=["title"],Wt={class:"d-flex gap-2 ms-auto"},Xt=["disabled"],Yt={class:"card-body"},Zt={key:0,class:"text-center py-5"},te={key:1,class:"text-center py-5"},ee={key:2,class:"row"},se={class:"card-header d-flex justify-content-between align-items-center py-2"},le={class:"d-flex align-items-center"},oe={class:"form-check me-2"},ae=["id","value"],ie={class:"fs-6"},ne={class:"card-body py-2"},re={key:0,class:"row g-2 mb-2"},de={class:"col-12"},ce={class:"text-muted text-truncate d-block"},ue={class:"row g-2 mb-2"},ve={class:"col-6"},be={class:"info-item-compact"},me={class:"fw-bold"},pe={class:"col-6"},fe={class:"info-item-compact"},ye={class:"text-truncate"},ge={class:"card-footer bg-transparent border-top-0 py-2"},_e={class:"d-flex gap-1 flex-wrap"},ke=["onClick","title"],he=["onClick","title"],we=["onClick","title"],xe={class:"dropdown"},Ce={class:"dropdown-menu dropdown-menu-end"},Le=["onClick"],Ae=["onClick"],Fe={class:"modal-content"},Ve={class:"modal-body"},$e={key:0,class:"alert alert-danger",role:"alert"},Se={class:"mb-0"},Me={class:"row g-3"},Te={class:"col-md-8"},Ue={class:"col-md-4"},Ie={class:"col-12"},De={class:"col-12"},Ee={class:"form-check"},je={class:"d-flex justify-content-end gap-2 mt-4"},ze=["disabled"],Be={class:"modal-content"},Ne={class:"modal-body"},qe={key:0,class:"alert alert-danger",role:"alert"},Pe={class:"mb-0"},Re={class:"row g-3"},Ge={class:"col-md-8"},He={class:"col-md-4"},Je={class:"col-12"},Ke={class:"col-12"},Oe={class:"form-check"},Qe={class:"d-flex justify-content-end gap-2 mt-4"},We=["disabled"],Xe={class:"modal-content"},Ye={class:"modal-header"},Ze={class:"modal-title"},ts={class:"modal-body"},es={key:0,class:"text-center py-4"},ss={key:1,class:"text-center py-4"},ls={key:2,class:"row"},os={class:"card border-0 shadow-sm"},as={class:"card-body py-2"},is={class:"d-flex justify-content-between align-items-center"},ns={class:"text-muted small"},rs=ut({__name:"LocationsManagementView",setup(ds){const G=mt(),H=vt(),o=r([]),k=r([]),h=r(!1),D=r(!1),V=r(!1),$=r(!1),w=r(""),S=r(!1),E=r(!1),j=r(!1),b=r({name:"",description:"",color:"#007bff",is_active:!0}),M=r(!1),y=r(""),v=r({}),x=r(null),T=r(!1),g=r(""),z=r(null),a=r([]),J=B(()=>Array.isArray(o.value)?o.value.filter(s=>s.is_active).length:0),K=B(()=>Array.isArray(o.value)?o.value.filter(s=>!s.is_active).length:0),O=B(()=>Array.isArray(o.value)?o.value.filter(s=>!w.value||w.value==="active"&&s.is_active||w.value==="inactive"&&!s.is_active):[]),Q=s=>new Date(s).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),W=s=>s?"bg-success":"bg-secondary",X=s=>s.is_active?"location-active":"location-inactive",Y=s=>0,C=async()=>{try{h.value=!0;const s=await u.getLocations();o.value=s.locations||s}catch(s){console.error("Failed to load locations:",s),o.value=[]}finally{h.value=!1}},U=()=>{S.value=!1,y.value="",b.value={name:"",description:"",color:"#007bff",is_active:!0}},Z=async()=>{try{M.value=!0,y.value="";const s=await u.createLocation(b.value);Array.isArray(o.value)?o.value.push(s):o.value=[s],U()}catch(s){console.error("Failed to create location:",s),s instanceof Error?y.value=s.message:y.value="Произошла неизвестная ошибка"}finally{M.value=!1}},tt=s=>{x.value=s.id,v.value={name:s.name,description:s.description||"",color:s.color||"#007bff",is_active:s.is_active},E.value=!0},I=()=>{E.value=!1,g.value="",v.value={},x.value=null},et=async()=>{if(!(!x.value||!Array.isArray(o.value)))try{T.value=!0,g.value="";const s=await u.updateLocation(x.value,v.value),e=o.value.findIndex(L=>L.id===x.value);e!==-1&&(o.value[e]=s),I()}catch(s){console.error("Failed to update location:",s),s instanceof Error?g.value=s.message:g.value="Произошла неизвестная ошибка"}finally{T.value=!1}},st=async s=>{z.value=s,j.value=!0;try{D.value=!0;const e=await u.getLocationTables(s.id);k.value=e.tables||e}catch(e){console.error("Failed to load location tables:",e),k.value=[]}finally{D.value=!1}},q=()=>{j.value=!1,z.value=null,k.value=[]},lt=async s=>{if(Array.isArray(o.value))try{const e=!s.is_active,L=await u.updateLocation(s.id,{is_active:e}),l=o.value.findIndex(p=>p.id===s.id);l!==-1&&(o.value[l]=L)}catch(e){console.error("Failed to toggle location status:",e)}},ot=async s=>{if(confirm(`Вы уверены, что хотите синхронизировать столики локации "${s.name}"?`))try{await u.syncLocationTables(s.id),alert("Синхронизация столиков выполнена успешно")}catch(e){console.error("Failed to sync location tables:",e),alert("Ошибка при синхронизации столиков")}},at=async s=>{if(Array.isArray(o.value)&&confirm(`Вы уверены, что хотите удалить локацию "${s.name}"?`))try{await u.deleteLocation(s.id),o.value=o.value.filter(e=>e.id!==s.id)}catch(e){console.error("Failed to delete location:",e)}},it=async()=>{try{V.value=!0;const s=await u.checkLocationsIntegrity();alert(s.message||"Проверка целостности выполнена")}catch(s){console.error("Failed to check integrity:",s),alert("Ошибка при проверке целостности")}finally{V.value=!1}},nt=async()=>{if(confirm("Вы уверены, что хотите выполнить автоматическое исправление проблем?"))try{$.value=!0;const s=await u.autoFixLocations();alert(s.message||"Автоматическое исправление выполнено"),await C()}catch(s){console.error("Failed to auto-fix:",s),alert("Ошибка при автоматическом исправлении")}finally{$.value=!1}},rt=async()=>{if(a.value.length&&confirm(`Вы уверены, что хотите активировать ${a.value.length} локаций?`))try{const s=a.value.map(e=>u.updateLocation(e,{is_active:!0}));await Promise.all(s),await C(),a.value=[]}catch(s){console.error("Failed to bulk activate locations:",s),alert("Ошибка при активации локаций")}},dt=async()=>{if(a.value.length&&confirm(`Вы уверены, что хотите деактивировать ${a.value.length} локаций?`))try{const s=a.value.map(e=>u.updateLocation(e,{is_active:!1}));await Promise.all(s),await C(),a.value=[]}catch(s){console.error("Failed to bulk deactivate locations:",s),alert("Ошибка при деактивации локаций")}},ct=async()=>{if(a.value.length&&confirm(`Вы уверены, что хотите удалить ${a.value.length} локаций? Это действие нельзя отменить.`))try{const s=a.value.map(e=>u.deleteLocation(e));await Promise.all(s),await C(),a.value=[]}catch(s){console.error("Failed to bulk delete locations:",s),alert("Ошибка при удалении локаций")}};return bt(async()=>{if(!H.isAuthenticated){G.push("/login");return}await C()}),(s,e)=>{const L=yt("router-link");return c(),d("div",ht,[t("div",wt,[t("div",xt,[t("div",Ct,[t("nav",Lt,[t("ol",At,[t("li",Ft,[pt(L,{to:"/dashboard",class:"text-decoration-none text-dark"},{default:ft(()=>e[15]||(e[15]=[t("i",{class:"bi bi-house me-1"},null,-1),n(" Главная ")])),_:1,__:[15]})]),e[16]||(e[16]=t("li",{class:"breadcrumb-item active text-muted","aria-current":"page"},"Управление локациями",-1))])]),t("div",Vt,[t("div",$t,[e[20]||(e[20]=t("h1",{class:"h2 mb-2 d-flex align-items-center"},[t("i",{class:"bi bi-geo-alt me-2 text-primary"}),n(" Управление локациями ")],-1)),t("p",St,[e[17]||(e[17]=n(" Всего локаций: ")),t("span",Mt,i(Array.isArray(o.value)?o.value.length:0),1),e[18]||(e[18]=n(" • Активных: ")),t("span",Tt,i(J.value),1),e[19]||(e[19]=n(" • Неактивных: ")),t("span",Ut,i(K.value),1)])]),t("div",It,[t("div",Dt,[t("button",{onClick:e[0]||(e[0]=l=>S.value=!0),class:"btn btn-primary",disabled:h.value},e[21]||(e[21]=[t("i",{class:"bi bi-plus-circle me-1"},null,-1),n(" Добавить локацию ")]),8,Et),t("button",{onClick:it,class:"btn btn-outline-warning",disabled:h.value||V.value,title:"Проверить целостность данных"},[e[22]||(e[22]=t("i",{class:"bi bi-shield-check me-1"},null,-1)),n(" "+i(V.value?"Проверка...":"Проверить"),1)],8,jt)])])])])])]),t("div",zt,[t("div",Bt,[t("div",Nt,[t("div",qt,[t("div",Pt,[t("div",Rt,[e[28]||(e[28]=t("div",{class:"col-md-4"},[t("h5",{class:"mb-0"},[t("i",{class:"bi bi-geo-alt me-2"}),n(" Список локаций ")])],-1)),t("div",Gt,[t("div",Ht,[a.value.length>0?(c(),d("div",Jt,[t("button",{class:"btn btn-outline-primary",onClick:rt,title:`Активировать ${a.value.length} локаций`},[e[23]||(e[23]=t("i",{class:"bi bi-check-circle me-1"},null,-1)),n(" Активировать ("+i(a.value.length)+") ",1)],8,Kt),t("button",{class:"btn btn-outline-secondary",onClick:dt,title:`Деактивировать ${a.value.length} локаций`},[e[24]||(e[24]=t("i",{class:"bi bi-x-circle me-1"},null,-1)),n(" Деактивировать ("+i(a.value.length)+") ",1)],8,Ot),t("button",{class:"btn btn-outline-danger",onClick:ct,title:`Удалить ${a.value.length} локаций`},[e[25]||(e[25]=t("i",{class:"bi bi-trash me-1"},null,-1)),n(" Удалить ("+i(a.value.length)+") ",1)],8,Qt)])):f("",!0),t("div",Wt,[m(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>w.value=l),class:"form-select form-select-sm"},e[26]||(e[26]=[t("option",{value:""},"Все статусы",-1),t("option",{value:"active"},"Активные",-1),t("option",{value:"inactive"},"Неактивные",-1)]),512),[[gt,w.value]]),t("button",{class:"btn btn-outline-primary btn-sm",onClick:nt,disabled:$.value,title:"Автоматическое исправление проблем"},[e[27]||(e[27]=t("i",{class:"bi bi-wrench me-1"},null,-1)),n(" "+i($.value?"Исправление...":"Авто-исправление"),1)],8,Xt)])])])])]),t("div",Yt,[h.value?(c(),d("div",Zt,e[29]||(e[29]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Загрузка...")],-1),t("p",{class:"text-muted mt-2"},"Загрузка локаций...",-1)]))):!Array.isArray(o.value)||o.value.length===0?(c(),d("div",te,[e[31]||(e[31]=t("i",{class:"bi bi-geo-alt text-muted",style:{"font-size":"3rem"}},null,-1)),e[32]||(e[32]=t("p",{class:"text-muted mt-3"},"Локации не найдены",-1)),t("button",{onClick:e[2]||(e[2]=l=>S.value=!0),class:"btn btn-primary"},e[30]||(e[30]=[t("i",{class:"bi bi-plus-circle me-1"},null,-1),n(" Добавить первую локацию ")]))])):(c(),d("div",ee,[(c(!0),d(P,null,R(O.value,l=>(c(),d("div",{key:l.id,class:"col-lg-4 col-md-6 mb-3"},[t("div",{class:F(["card border-0 shadow-sm location-card",X(l)])},[t("div",se,[t("div",le,[t("div",oe,[m(t("input",{class:"form-check-input",type:"checkbox",id:`location-${l.id}`,"onUpdate:modelValue":e[3]||(e[3]=p=>a.value=p),value:l.id},null,8,ae),[[N,a.value]])]),t("div",{class:"location-color-indicator me-2",style:_t({backgroundColor:l.color||"#6c757d"})},null,4),t("strong",ie,i(l.name),1)]),t("span",{class:F(["badge badge-sm",W(l.is_active)])},i(l.is_active?"Активна":"Неактивна"),3)]),t("div",ne,[l.description?(c(),d("div",re,[t("div",de,[t("small",ce,i(l.description),1)])])):f("",!0),t("div",ue,[t("div",ve,[t("div",be,[e[33]||(e[33]=t("i",{class:"bi bi-table text-primary me-1"},null,-1)),t("span",me,i(Y(l.id)),1),e[34]||(e[34]=t("small",{class:"text-muted ms-1"},"столиков",-1))])]),t("div",pe,[t("div",fe,[e[35]||(e[35]=t("i",{class:"bi bi-clock text-info me-1"},null,-1)),t("small",ye,i(Q(l.updated_at)),1)])])])]),t("div",ge,[t("div",_e,[t("button",{class:"btn btn-sm btn-outline-primary flex-fill",onClick:p=>st(l),title:"Просмотреть столики локации "+l.name},e[36]||(e[36]=[t("i",{class:"bi bi-table"},null,-1)]),8,ke),t("button",{class:"btn btn-sm btn-outline-secondary flex-fill",onClick:p=>tt(l),title:"Редактировать локацию "+l.name},e[37]||(e[37]=[t("i",{class:"bi bi-pencil"},null,-1)]),8,he),t("button",{class:F(["btn btn-sm flex-fill",l.is_active?"btn-outline-warning":"btn-outline-success"]),onClick:p=>lt(l),title:l.is_active?"Деактивировать локацию":"Активировать локацию"},[t("i",{class:F(["bi",l.is_active?"bi-toggle-off":"bi-toggle-on"])},null,2)],10,we),t("div",xe,[e[41]||(e[41]=t("button",{class:"btn btn-sm btn-outline-secondary dropdown-toggle-split",type:"button","data-bs-toggle":"dropdown",title:"Дополнительные действия"},[t("i",{class:"bi bi-three-dots"})],-1)),t("ul",Ce,[t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:p=>ot(l)},e[38]||(e[38]=[t("i",{class:"bi bi-arrow-clockwise me-2"},null,-1),n(" Синхронизировать столики ")]),8,Le)]),e[40]||(e[40]=t("li",null,[t("hr",{class:"dropdown-divider"})],-1)),t("li",null,[t("a",{class:"dropdown-item text-danger",href:"#",onClick:p=>at(l)},e[39]||(e[39]=[t("i",{class:"bi bi-trash me-2"},null,-1),n(" Удалить ")]),8,Ae)])])])])])],2)]))),128))]))])])])])]),S.value?(c(),d("div",{key:0,class:"modal fade show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"},onClick:U},[t("div",{class:"modal-dialog modal-dialog-centered modal-lg",onClick:e[8]||(e[8]=A(()=>{},["stop"]))},[t("div",Fe,[t("div",{class:"modal-header"},[e[42]||(e[42]=t("h5",{class:"modal-title"},[t("i",{class:"bi bi-plus-circle me-2"}),n(" Добавить локацию ")],-1)),t("button",{type:"button",class:"btn-close",onClick:U})]),t("div",Ve,[y.value?(c(),d("div",$e,[t("pre",Se,i(y.value),1)])):f("",!0),t("form",{onSubmit:A(Z,["prevent"])},[t("div",Me,[t("div",Te,[e[43]||(e[43]=t("label",{class:"form-label"},"Название локации",-1)),m(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>b.value.name=l),type:"text",class:"form-control",required:"",placeholder:"Основной зал"},null,512),[[_,b.value.name]])]),t("div",Ue,[e[44]||(e[44]=t("label",{class:"form-label"},"Цвет",-1)),m(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>b.value.color=l),type:"color",class:"form-control form-control-color"},null,512),[[_,b.value.color]])]),t("div",Ie,[e[45]||(e[45]=t("label",{class:"form-label"},"Описание",-1)),m(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=l=>b.value.description=l),class:"form-control",rows:"3",placeholder:"Дополнительная информация о локации"},null,512),[[_,b.value.description]])]),t("div",De,[t("div",Ee,[m(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>b.value.is_active=l),class:"form-check-input",type:"checkbox",id:"createActive"},null,512),[[N,b.value.is_active]]),e[46]||(e[46]=t("label",{class:"form-check-label",for:"createActive"}," Активна ",-1))])])]),t("div",je,[t("button",{type:"button",onClick:U,class:"btn btn-secondary"}," Отмена "),t("button",{type:"submit",class:"btn btn-primary",disabled:M.value},[e[47]||(e[47]=t("i",{class:"bi bi-plus-circle me-1"},null,-1)),n(" "+i(M.value?"Создание...":"Создать"),1)],8,ze)])],32)])])])])):f("",!0),E.value?(c(),d("div",{key:1,class:"modal fade show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"},onClick:I},[t("div",{class:"modal-dialog modal-dialog-centered modal-lg",onClick:e[13]||(e[13]=A(()=>{},["stop"]))},[t("div",Be,[t("div",{class:"modal-header"},[e[48]||(e[48]=t("h5",{class:"modal-title"},[t("i",{class:"bi bi-pencil me-2"}),n(" Редактировать локацию ")],-1)),t("button",{type:"button",class:"btn-close",onClick:I})]),t("div",Ne,[g.value?(c(),d("div",qe,[t("pre",Pe,i(g.value),1)])):f("",!0),t("form",{onSubmit:A(et,["prevent"])},[t("div",Re,[t("div",Ge,[e[49]||(e[49]=t("label",{class:"form-label"},"Название локации",-1)),m(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>v.value.name=l),type:"text",class:"form-control",required:""},null,512),[[_,v.value.name]])]),t("div",He,[e[50]||(e[50]=t("label",{class:"form-label"},"Цвет",-1)),m(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>v.value.color=l),type:"color",class:"form-control form-control-color"},null,512),[[_,v.value.color]])]),t("div",Je,[e[51]||(e[51]=t("label",{class:"form-label"},"Описание",-1)),m(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=l=>v.value.description=l),class:"form-control",rows:"3"},null,512),[[_,v.value.description]])]),t("div",Ke,[t("div",Oe,[m(t("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>v.value.is_active=l),class:"form-check-input",type:"checkbox",id:"editActive"},null,512),[[N,v.value.is_active]]),e[52]||(e[52]=t("label",{class:"form-check-label",for:"editActive"}," Активна ",-1))])])]),t("div",Qe,[t("button",{type:"button",onClick:I,class:"btn btn-secondary"}," Отмена "),t("button",{type:"submit",class:"btn btn-primary",disabled:T.value},[e[53]||(e[53]=t("i",{class:"bi bi-check-circle me-1"},null,-1)),n(" "+i(T.value?"Сохранение...":"Сохранить"),1)],8,We)])],32)])])])])):f("",!0),j.value?(c(),d("div",{key:2,class:"modal fade show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"},onClick:q},[t("div",{class:"modal-dialog modal-dialog-centered modal-xl",onClick:e[14]||(e[14]=A(()=>{},["stop"]))},[t("div",Xe,[t("div",Ye,[t("h5",Ze,[e[54]||(e[54]=t("i",{class:"bi bi-table me-2"},null,-1)),n(' Столики локации "'+i(z.value?.name)+'" ',1)]),t("button",{type:"button",class:"btn-close",onClick:q})]),t("div",ts,[D.value?(c(),d("div",es,e[55]||(e[55]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Загрузка столиков...")],-1)]))):k.value.length===0?(c(),d("div",ss,e[56]||(e[56]=[t("i",{class:"bi bi-table text-muted",style:{"font-size":"2rem"}},null,-1),t("p",{class:"text-muted mt-2"},"В данной локации нет столиков",-1)]))):(c(),d("div",ls,[(c(!0),d(P,null,R(k.value,l=>(c(),d("div",{key:l.id,class:"col-md-4 mb-3"},[t("div",os,[t("div",as,[t("div",is,[t("div",null,[t("strong",null,"Столик "+i(l.number),1),t("div",ns,i(l.seats)+" мест",1)]),t("span",{class:F(["badge",l.is_active?"bg-success":"bg-secondary"])},i(l.is_active?"Активен":"Неактивен"),3)])])])]))),128))]))])])])])):f("",!0)])}}}),us=kt(rs,[["__scopeId","data-v-7dea676a"]]);export{us as default};

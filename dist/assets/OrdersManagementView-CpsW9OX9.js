import{d as K,r as m,c as Q,o as W,b as i,e as s,f as u,g as X,w as Y,h as Z,i as d,t as a,z as v,A as y,j as N,k as q,y as ss,F as S,l as z,s as c,m as O,x as M,B as A,p as T,a as ts,q as n,_ as es}from"./index-BRWVB6f9.js";const ls={class:"orders-page"},as={class:"container-fluid py-4"},os={class:"card shadow-sm border-0 mb-4 p-3"},is={class:"card-body"},ns={"aria-label":"breadcrumb",class:"mb-3"},ds={class:"breadcrumb mb-0"},rs={class:"breadcrumb-item"},us={class:"row align-items-center"},cs={class:"col-md-8"},ms={class:"text-muted mb-0"},vs={class:"badge bg-primary"},bs={class:"badge bg-warning"},ps={class:"badge bg-success"},_s={class:"badge bg-danger"},gs={class:"badge bg-info"},ys={class:"col-md-4 text-end"},fs={class:"btn-group"},xs=["disabled"],hs=["disabled"],ks={class:"container-fluid"},ws={class:"row"},Cs={class:"col-12"},$s={class:"card shadow-sm border-0"},Ss={class:"card-header bg-white"},zs={class:"row align-items-center"},Os={class:"col-md-8"},Ms={class:"d-flex gap-2 align-items-center"},Ts={class:"d-flex gap-2 ms-auto"},Vs={class:"card-body p-0"},Ls={key:0,class:"text-center py-5"},Ps={key:1,class:"text-center py-5"},Bs={key:2,class:"table-responsive"},Fs={class:"table table-hover mb-0"},js={class:"d-flex align-items-center"},Ns={key:0,class:"ms-2 text-muted small"},qs={key:0,class:"badge bg-light text-dark"},As={key:1,class:"badge bg-light text-dark"},Ds={key:2,class:"text-muted"},Is={key:0,class:"text-truncate"},Rs={key:1,class:"text-muted"},Us={key:0,class:"text-muted small"},Es={key:0,class:"text-muted small"},Gs={class:"text-muted small"},Hs=["onClick"],Js={key:3,class:"card-footer bg-white"},Ks={"aria-label":"Навигация по страницам"},Qs={class:"pagination pagination-sm justify-content-center mb-0"},Ws=["onClick"],Xs={class:"modal-dialog modal-lg"},Ys={class:"modal-content"},Zs={class:"modal-header"},st={class:"modal-footer"},tt={class:"modal-dialog modal-xl"},et={key:0,class:"modal-content order-modal"},lt={class:"modal-header bg-gradient-primary text-white border-0"},at={class:"d-flex align-items-center"},ot={class:"modal-title mb-0"},it={class:"opacity-75"},nt={class:"modal-body p-0"},dt={class:"order-status-bar p-3 border-bottom"},rt={class:"row align-items-center"},ut={class:"col-md-4"},ct={class:"status-item"},mt={class:"col-md-4"},vt={class:"status-item"},bt={class:"col-md-4 text-end"},pt={class:"total-amount"},_t={class:"mb-0 text-success fw-bold"},gt={class:"row g-0"},yt={class:"col-md-6 border-end"},ft={class:"p-4"},xt={class:"order-info-grid"},ht={class:"info-item mb-3"},kt={class:"info-value"},wt={key:0,class:"info-item mb-3"},Ct={class:"info-value"},$t={class:"badge bg-light text-dark"},St={key:1,class:"info-item mb-3"},zt={class:"info-value"},Ot={key:2,class:"info-item mb-3"},Mt={class:"info-value"},Tt={key:3,class:"info-item mb-3"},Vt={class:"info-value"},Lt=["href"],Pt={key:4,class:"info-item mb-3"},Bt={class:"info-value"},Ft={key:5,class:"info-item mb-3"},jt={class:"info-value"},Nt={class:"col-md-6"},qt={class:"p-4"},At={class:"text-primary mb-3 fw-bold"},Dt={key:0,class:"badge bg-light text-dark ms-2"},It={key:0,class:"order-items"},Rt={class:"d-flex justify-content-between align-items-start"},Ut={class:"flex-grow-1"},Et={class:"mb-1"},Gt={class:"d-flex align-items-center text-muted small"},Ht={class:"quantity-badge me-2"},Jt={key:0,class:"item-notes mt-1"},Kt={class:"text-muted"},Qt={class:"text-end"},Wt={class:"item-total fw-bold"},Xt={class:"order-totals mt-4 pt-3 border-top"},Yt={class:"d-flex justify-content-between fw-bold fs-5 text-success"},Zt={key:1,class:"text-center py-4"},se={class:"modal-footer bg-light border-0"},te={class:"modal-dialog"},ee={key:0,class:"modal-content"},le={class:"modal-header"},ae={class:"modal-title"},oe={class:"modal-body"},ie={class:"modal-footer"},ne=K({__name:"OrdersManagementView",setup(de){ts();const f=m(!1),k=m([]),x=m({total_orders:0,pending_orders:0,completed_orders:0,cancelled_orders:0,total_revenue:0,average_order_value:0,orders_by_status:{},orders_by_type:{}}),_=m(1),w=m(1),D=m(20),C=m(""),$=m(""),b=m(!1),p=m(!1),h=m(!1),o=m(null),I=Q(()=>{const l=[],t=w.value,r=_.value;if(t<=7)for(let e=1;e<=t;e++)l.push(e);else if(r<=4){for(let e=1;e<=5;e++)l.push(e);l.push(-1),l.push(t)}else if(r>=t-3){l.push(1),l.push(-1);for(let e=t-4;e<=t;e++)l.push(e)}else{l.push(1),l.push(-1);for(let e=r-1;e<=r+1;e++)l.push(e);l.push(-1),l.push(t)}return l}),g=async(l=1)=>{try{f.value=!0;const t=await T.getOrders(l,D.value,C.value||void 0,$.value||void 0);k.value=t.orders,_.value=t.page,w.value=Math.ceil(t.total/t.per_page)}catch(t){console.error("Failed to load orders:",t),k.value=[]}finally{f.value=!1}},R=async()=>{try{const l=await T.getOrdersStats();x.value=l}catch(l){console.error("Failed to load orders stats:",l)}},U=async l=>{try{o.value=await T.getOrder(l.id),p.value=!0}catch(t){console.error("Failed to load order details:",t),o.value=l,p.value=!0}},E=()=>{b.value=!1,p.value=!1,h.value=!1,o.value=null},G=l=>{const t=[],r=l.status?.toLowerCase();return r==="cancelled"?t.push("table-danger"):r==="completed"?t.push("table-success"):r==="pending"&&t.push("table-warning"),t.join(" ")},V=l=>{const t=l?.toLowerCase();return{dine_in:"bg-primary",takeaway:"bg-info",delivery:"bg-warning"}[t]||"bg-secondary"},L=l=>{const t=l?.toLowerCase();return{dine_in:"В зале",takeaway:"На вынос",delivery:"Доставка"}[t]||`Неизвестный тип: ${l}`},H=l=>{const t=l?.toLowerCase();return{dine_in:"bi-house",takeaway:"bi-bag",delivery:"bi-truck"}[t]||"bi-question-circle"},P=l=>{const t=l?.toLowerCase();return{pending:"bg-warning text-dark",ready:"bg-info",served:"bg-primary",dining:"bg-secondary",completed:"bg-success",cancelled:"bg-danger"}[t]||"bg-secondary"},B=l=>{const t=l?.toLowerCase();return{pending:"В обработке",ready:"Готов",served:"Подан",dining:"За столом",completed:"Завершен",cancelled:"Отменен"}[t]||`Неизвестный статус: ${l}`},F=l=>{const t=l?.toLowerCase();return{unpaid:"bg-warning text-dark",paid:"bg-success",refunded:"bg-danger"}[t]||"bg-secondary"},j=l=>{const t=l?.toLowerCase();return{unpaid:"Не оплачен",paid:"Оплачен",refunded:"Возврат"}[t]||`Неизвестный статус оплаты: ${l}`};return W(async()=>{await Promise.all([g(),R()])}),(l,t)=>{const r=Z("router-link");return n(),i("div",ls,[s("div",as,[s("div",os,[s("div",is,[s("nav",ns,[s("ol",ds,[s("li",rs,[X(r,{to:"/dashboard",class:"text-decoration-none text-dark"},{default:Y(()=>t[15]||(t[15]=[s("i",{class:"bi bi-house me-1"},null,-1),d(" Главная ")])),_:1,__:[15]})]),t[16]||(t[16]=s("li",{class:"breadcrumb-item active text-muted","aria-current":"page"},"Управление заказами",-1))])]),s("div",us,[s("div",cs,[t[22]||(t[22]=s("h1",{class:"h2 mb-2 d-flex align-items-center"},[s("i",{class:"bi bi-receipt-cutoff me-2 text-primary"}),d(" Управление заказами ")],-1)),s("p",ms,[t[17]||(t[17]=d(" Всего заказов: ")),s("span",vs,a(x.value.total_orders||0),1),t[18]||(t[18]=d(" • В обработке: ")),s("span",bs,a(x.value.pending_orders||0),1),t[19]||(t[19]=d(" • Завершенных: ")),s("span",ps,a(x.value.completed_orders||0),1),t[20]||(t[20]=d(" • Отмененных: ")),s("span",_s,a(x.value.cancelled_orders||0),1),t[21]||(t[21]=d(" • Выручка: ")),s("span",gs,a(v(y)(x.value.total_revenue||0)),1)])]),s("div",ys,[s("div",fs,[s("button",{onClick:t[0]||(t[0]=e=>b.value=!0),class:"btn btn-primary",disabled:f.value},t[23]||(t[23]=[s("i",{class:"bi bi-plus-circle me-1"},null,-1),d(" Новый заказ ")]),8,xs),s("button",{onClick:t[1]||(t[1]=e=>g()),class:"btn btn-outline-secondary",disabled:f.value,title:"Обновить список заказов"},[t[24]||(t[24]=s("i",{class:"bi bi-arrow-clockwise me-1"},null,-1)),d(" "+a(f.value?"Загрузка...":"Обновить"),1)],8,hs)])])])])])]),s("div",ks,[s("div",ws,[s("div",Cs,[s("div",$s,[s("div",Ss,[s("div",zs,[t[27]||(t[27]=s("div",{class:"col-md-4"},[s("h5",{class:"mb-0"},[s("i",{class:"bi bi-receipt-cutoff me-2"}),d(" Список заказов ")])],-1)),s("div",Os,[s("div",Ms,[s("div",Ts,[N(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>C.value=e),class:"form-select form-select-sm",onChange:t[3]||(t[3]=e=>g())},t[25]||(t[25]=[ss('<option value="" data-v-74659eae>Все статусы</option><option value="pending" data-v-74659eae>В обработке</option><option value="ready" data-v-74659eae>Готов</option><option value="served" data-v-74659eae>Подан</option><option value="dining" data-v-74659eae>За столом</option><option value="completed" data-v-74659eae>Завершен</option><option value="cancelled" data-v-74659eae>Отменен</option>',7)]),544),[[q,C.value]]),N(s("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>$.value=e),class:"form-select form-select-sm",onChange:t[5]||(t[5]=e=>g())},t[26]||(t[26]=[s("option",{value:""},"Все типы",-1),s("option",{value:"dine_in"},"В зале",-1),s("option",{value:"takeaway"},"На вынос",-1),s("option",{value:"delivery"},"Доставка",-1)]),544),[[q,$.value]])])])])])]),s("div",Vs,[f.value?(n(),i("div",Ls,t[28]||(t[28]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Загрузка...")],-1),s("p",{class:"text-muted mt-2"},"Загрузка заказов...",-1)]))):!Array.isArray(k.value)||k.value.length===0?(n(),i("div",Ps,[t[30]||(t[30]=s("i",{class:"bi bi-receipt-cutoff text-muted",style:{"font-size":"3rem"}},null,-1)),t[31]||(t[31]=s("p",{class:"text-muted mt-3"},"Заказы не найдены",-1)),s("button",{onClick:t[6]||(t[6]=e=>b.value=!0),class:"btn btn-primary"},t[29]||(t[29]=[s("i",{class:"bi bi-plus-circle me-1"},null,-1),d(" Создать первый заказ ")]))])):(n(),i("div",Bs,[s("table",Fs,[t[33]||(t[33]=s("thead",{class:"table-light"},[s("tr",null,[s("th",{class:"border-0"},"№ Заказа"),s("th",{class:"border-0"},"Столик"),s("th",{class:"border-0"},"Тип"),s("th",{class:"border-0"},"Официант"),s("th",{class:"border-0"},"Сумма"),s("th",{class:"border-0"},"Статус"),s("th",{class:"border-0"},"Оплата"),s("th",{class:"border-0"},"Время"),s("th",{class:"border-0"},"Действия")])],-1)),s("tbody",null,[(n(!0),i(S,null,z(k.value,e=>(n(),i("tr",{key:e.id,class:c(G(e))},[s("td",null,[s("div",js,[s("strong",null,"#"+a(e.id),1),e.customer_name?(n(),i("span",Ns,a(e.customer_name),1)):u("",!0)])]),s("td",null,[e.table_id?(n(),i("span",qs," Столик "+a(e.table_id),1)):e.table_name?(n(),i("span",As,a(e.table_name),1)):(n(),i("span",Ds,"—"))]),s("td",null,[s("span",{class:c(["badge",V(e.order_type)])},a(L(e.order_type)),3)]),s("td",null,[e.waiter_id?(n(),i("span",Is,a(e.waiter_name||`Официант ${e.waiter_id}`),1)):(n(),i("span",Rs,"—"))]),s("td",null,[s("strong",null,a(v(y)(e.total_price)),1),e.items?.length?(n(),i("div",Us,a(e.items.length)+" поз. ",1)):u("",!0)]),s("td",null,[s("span",{class:c(["badge",P(e.status)])},a(B(e.status)),3)]),s("td",null,[s("span",{class:c(["badge",F(e.payment_status)])},a(j(e.payment_status)),3),e.payment_method_name?(n(),i("div",Es,a(e.payment_method_name),1)):u("",!0)]),s("td",null,[s("div",Gs,a(v(A)(e.created_at)),1)]),s("td",null,[s("button",{class:"btn btn-outline-primary btn-sm",onClick:J=>U(e),title:"Просмотреть заказ"},t[32]||(t[32]=[s("i",{class:"bi bi-eye me-1"},null,-1),d(" Просмотреть ")]),8,Hs)])],2))),128))])])])),w.value>1?(n(),i("div",Js,[s("nav",Ks,[s("ul",Qs,[s("li",{class:c(["page-item",{disabled:_.value===1}])},[s("a",{class:"page-link",href:"#",onClick:t[7]||(t[7]=O(e=>g(_.value-1),["prevent"]))},t[34]||(t[34]=[s("i",{class:"bi bi-chevron-left"},null,-1)]))],2),(n(!0),i(S,null,z(I.value,e=>(n(),i("li",{key:e,class:c(["page-item",{active:e===_.value}])},[s("a",{class:"page-link",href:"#",onClick:O(J=>g(e),["prevent"])},a(e),9,Ws)],2))),128)),s("li",{class:c(["page-item",{disabled:_.value===w.value}])},[s("a",{class:"page-link",href:"#",onClick:t[8]||(t[8]=O(e=>g(_.value+1),["prevent"]))},t[35]||(t[35]=[s("i",{class:"bi bi-chevron-right"},null,-1)]))],2)])])])):u("",!0)])])])])]),s("div",{class:c(["modal fade",{show:b.value}]),tabindex:"-1",style:M({display:b.value?"block":"none"})},[s("div",Xs,[s("div",Ys,[s("div",Zs,[t[36]||(t[36]=s("h5",{class:"modal-title"},[s("i",{class:"bi bi-plus-circle me-2"}),d(" Создать новый заказ ")],-1)),s("button",{type:"button",class:"btn-close",onClick:t[9]||(t[9]=e=>b.value=!1)})]),t[37]||(t[37]=s("div",{class:"modal-body"},[s("p",{class:"text-muted"},"Функция создания заказов будет доступна в следующих версиях системы.")],-1)),s("div",st,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=e=>b.value=!1)}," Закрыть ")])])])],6),s("div",{class:c(["modal fade",{show:p.value}]),tabindex:"-1",style:M({display:p.value?"block":"none"})},[s("div",tt,[o.value?(n(),i("div",et,[s("div",lt,[s("div",at,[t[38]||(t[38]=s("div",{class:"order-icon me-3"},[s("i",{class:"bi bi-receipt-cutoff"})],-1)),s("div",null,[s("h5",ot,"Заказ #"+a(o.value.id),1),s("small",it,a(v(A)(o.value.created_at)),1)])]),s("button",{type:"button",class:"btn-close btn-close-white",onClick:t[11]||(t[11]=e=>p.value=!1)})]),s("div",nt,[s("div",dt,[s("div",rt,[s("div",ut,[s("div",ct,[t[40]||(t[40]=s("small",{class:"text-muted d-block"},"Статус заказа",-1)),s("span",{class:c(["badge fs-6 px-3 py-2",P(o.value.status)])},[t[39]||(t[39]=s("i",{class:"bi bi-circle-fill me-1",style:{"font-size":"0.6rem"}},null,-1)),d(" "+a(B(o.value.status)),1)],2)])]),s("div",mt,[s("div",vt,[t[42]||(t[42]=s("small",{class:"text-muted d-block"},"Оплата",-1)),s("span",{class:c(["badge fs-6 px-3 py-2",F(o.value.payment_status)])},[t[41]||(t[41]=s("i",{class:"bi bi-credit-card me-1"},null,-1)),d(" "+a(j(o.value.payment_status)),1)],2)])]),s("div",bt,[s("div",pt,[t[43]||(t[43]=s("small",{class:"text-muted d-block"},"Общая сумма",-1)),s("h4",_t,a(v(y)(o.value.total_price)),1)])])])]),s("div",gt,[s("div",yt,[s("div",ft,[t[52]||(t[52]=s("h6",{class:"text-primary mb-3 fw-bold"},[s("i",{class:"bi bi-info-circle me-2"}),d(" Информация о заказе ")],-1)),s("div",xt,[s("div",ht,[t[44]||(t[44]=s("div",{class:"info-label"},[s("i",{class:"bi bi-tag text-muted me-2"}),s("small",{class:"text-muted"},"Тип заказа")],-1)),s("div",kt,[s("span",{class:c(["badge",V(o.value.order_type)])},[s("i",{class:c(["bi me-1",H(o.value.order_type)])},null,2),d(" "+a(L(o.value.order_type)),1)],2)])]),o.value.table_name||o.value.table_id?(n(),i("div",wt,[t[46]||(t[46]=s("div",{class:"info-label"},[s("i",{class:"bi bi-house text-muted me-2"}),s("small",{class:"text-muted"},"Столик")],-1)),s("div",Ct,[s("span",$t,[t[45]||(t[45]=s("i",{class:"bi bi-table me-1"},null,-1)),d(" "+a(o.value.table_name||`Столик ${o.value.table_id}`),1)])])])):u("",!0),o.value.waiter_name||o.value.waiter_id?(n(),i("div",St,[t[47]||(t[47]=s("div",{class:"info-label"},[s("i",{class:"bi bi-person text-muted me-2"}),s("small",{class:"text-muted"},"Официант")],-1)),s("div",zt,a(o.value.waiter_name||`Официант ${o.value.waiter_id}`),1)])):u("",!0),o.value.customer_name?(n(),i("div",Ot,[t[48]||(t[48]=s("div",{class:"info-label"},[s("i",{class:"bi bi-person-circle text-muted me-2"}),s("small",{class:"text-muted"},"Клиент")],-1)),s("div",Mt,a(o.value.customer_name),1)])):u("",!0),o.value.customer_phone?(n(),i("div",Tt,[t[49]||(t[49]=s("div",{class:"info-label"},[s("i",{class:"bi bi-telephone text-muted me-2"}),s("small",{class:"text-muted"},"Телефон")],-1)),s("div",Vt,[s("a",{href:`tel:${o.value.customer_phone}`,class:"text-decoration-none"},a(o.value.customer_phone),9,Lt)])])):u("",!0),o.value.delivery_address?(n(),i("div",Pt,[t[50]||(t[50]=s("div",{class:"info-label"},[s("i",{class:"bi bi-geo-alt text-muted me-2"}),s("small",{class:"text-muted"},"Адрес доставки")],-1)),s("div",Bt,a(o.value.delivery_address),1)])):u("",!0),o.value.payment_method_name?(n(),i("div",Ft,[t[51]||(t[51]=s("div",{class:"info-label"},[s("i",{class:"bi bi-credit-card text-muted me-2"}),s("small",{class:"text-muted"},"Способ оплаты")],-1)),s("div",jt,a(o.value.payment_method_name),1)])):u("",!0)])])]),s("div",Nt,[s("div",qt,[s("h6",At,[t[53]||(t[53]=s("i",{class:"bi bi-list-ul me-2"},null,-1)),t[54]||(t[54]=d(" Состав заказа ")),o.value.items?.length?(n(),i("span",Dt,a(o.value.items.length)+" позиций ",1)):u("",!0)]),o.value.items?.length?(n(),i("div",It,[(n(!0),i(S,null,z(o.value.items,e=>(n(),i("div",{key:e.id,class:"order-item-card mb-3"},[s("div",Rt,[s("div",Ut,[s("h6",Et,a(e.dish_name),1),s("div",Gt,[s("span",Ht,a(e.quantity)+" шт.",1),s("span",null,"× "+a(v(y)(e.unit_price)),1)]),e.notes?(n(),i("div",Jt,[s("small",Kt,[t[55]||(t[55]=s("i",{class:"bi bi-chat-dots me-1"},null,-1)),d(" "+a(e.notes),1)])])):u("",!0)]),s("div",Qt,[s("div",Wt,a(v(y)(e.total_price)),1)])])]))),128)),s("div",Xt,[s("div",Yt,[t[56]||(t[56]=s("span",null,"Итого:",-1)),s("span",null,a(v(y)(o.value.total_price)),1)])])])):(n(),i("div",Zt,t[57]||(t[57]=[s("i",{class:"bi bi-basket text-muted",style:{"font-size":"2rem"}},null,-1),s("p",{class:"text-muted mt-2 mb-0"},"Состав заказа не загружен",-1)])))])])])]),s("div",se,[s("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[12]||(t[12]=e=>p.value=!1)},t[58]||(t[58]=[s("i",{class:"bi bi-x-circle me-1"},null,-1),d(" Закрыть ")]))])])):u("",!0)])],6),s("div",{class:c(["modal fade",{show:h.value}]),tabindex:"-1",style:M({display:h.value?"block":"none"})},[s("div",te,[o.value?(n(),i("div",ee,[s("div",le,[s("h5",ae,[t[59]||(t[59]=s("i",{class:"bi bi-credit-card me-2"},null,-1)),d(" Оплата заказа #"+a(o.value.id),1)]),s("button",{type:"button",class:"btn-close",onClick:t[13]||(t[13]=e=>h.value=!1)})]),s("div",oe,[t[61]||(t[61]=s("p",{class:"text-muted"},"Функция оплаты заказов будет доступна в следующих версиях системы.",-1)),s("p",null,[t[60]||(t[60]=s("strong",null,"Сумма к оплате:",-1)),d(" "+a(v(y)(o.value.total_price)),1)])]),s("div",ie,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[14]||(t[14]=e=>h.value=!1)}," Закрыть ")])])):u("",!0)])],6),b.value||p.value||h.value?(n(),i("div",{key:0,class:"modal-backdrop fade show",onClick:E})):u("",!0)])}}}),ue=es(ne,[["__scopeId","data-v-74659eae"]]);export{ue as default};

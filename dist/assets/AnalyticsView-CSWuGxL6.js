import{d as V,r as w,o as z,b as n,e as s,g as F,w as M,h as P,i as _,t as o,z as f,A as u,F as k,l as C,f as B,p as E,C as N,s as R,a as W,q as c,_ as D}from"./index-BRWVB6f9.js";const I={class:"analytics-page"},$={class:"container-fluid py-4"},q={class:"card shadow-sm border-0 mb-4 p-3"},H={class:"card-body"},L={"aria-label":"breadcrumb",class:"mb-3"},X={class:"breadcrumb mb-0"},G={class:"breadcrumb-item"},J={class:"row align-items-center"},K={class:"col-md-4 text-end"},O={class:"btn-group"},Q=["disabled"],U=["disabled"],Y={class:"container-fluid"},Z={key:0,class:"text-center py-5"},ss={key:1,class:"row"},ts={class:"col-12 mb-4"},es={class:"row g-3"},is={class:"col-lg-3 col-md-6"},os={class:"card stats-card border-0 h-100"},as={class:"card-body"},ls={class:"d-flex align-items-center"},ds={class:"flex-grow-1"},ns={class:"mb-0"},cs={class:"text-success"},rs={class:"col-lg-3 col-md-6"},_s={class:"card stats-card border-0 h-100"},vs={class:"card-body"},bs={class:"d-flex align-items-center"},ms={class:"flex-grow-1"},us={class:"mb-0"},hs={class:"text-info"},gs={class:"col-lg-3 col-md-6"},ps={class:"card stats-card border-0 h-100"},xs={class:"card-body"},ys={class:"d-flex align-items-center"},fs={class:"flex-grow-1"},ws={class:"mb-0"},ks={class:"text-warning"},Cs={class:"col-lg-3 col-md-6"},Ts={class:"card stats-card border-0 h-100"},Ss={class:"card-body"},js={class:"d-flex align-items-center"},As={class:"flex-grow-1"},Vs={class:"mb-0"},zs={class:"text-info"},Fs={class:"col-lg-8 mb-4"},Ms={class:"card border-0 h-100"},Ps={class:"card-body"},Bs={key:0,class:"chart-container"},Es={key:1,class:"text-center py-4"},Ns={class:"col-lg-4 mb-4"},Rs={class:"card border-0 h-100"},Ws={class:"card-body"},Ds={key:0,class:"top-dishes-list"},Is={class:"dish-rank me-3"},$s={class:"flex-grow-1"},qs={class:"mb-1"},Hs={class:"text-muted"},Ls={class:"text-end"},Xs={class:"fw-bold text-success"},Gs={key:1,class:"text-center py-4"},Js={class:"col-lg-6 mb-4"},Ks={class:"card border-0 h-100"},Os={class:"card-body"},Qs={class:"row g-3"},Us={class:"col-6"},Ys={class:"stat-item text-center"},Zs={class:"stat-value text-warning"},st={class:"col-6"},tt={class:"stat-item text-center"},et={class:"stat-value text-success"},it={class:"col-6"},ot={class:"stat-item text-center"},at={class:"stat-value text-danger"},lt={class:"col-6"},dt={class:"stat-item text-center"},nt={class:"stat-value text-info"},ct={class:"mt-4"},rt={class:"order-types"},_t={class:"d-flex justify-content-between align-items-center mb-2"},vt={class:"fw-bold"},bt={class:"d-flex justify-content-between align-items-center mb-2"},mt={class:"fw-bold"},ut={class:"d-flex justify-content-between align-items-center"},ht={class:"fw-bold"},gt={class:"col-lg-6 mb-4"},pt={class:"card border-0 h-100"},xt={class:"card-body"},yt={class:"performance-metrics"},ft={class:"metric-item mb-3"},wt={class:"d-flex justify-content-between align-items-center"},kt={class:"fw-bold"},Ct={class:"metric-item mb-3"},Tt={class:"d-flex justify-content-between align-items-center"},St={class:"fw-bold"},jt={class:"metric-item mb-4"},At={class:"d-flex justify-content-between align-items-center"},Vt={class:"fw-bold"},zt={key:0},Ft={class:"peak-hours"},Mt={class:"col-12 mb-4"},Pt={class:"card border-0"},Bt={class:"card-body"},Et={key:0,class:"row g-3"},Nt={class:"payment-method-card"},Rt={class:"d-flex justify-content-between align-items-center"},Wt={class:"mb-1"},Dt={class:"text-muted"},It={class:"text-end"},$t={class:"fw-bold text-success"},qt={key:1,class:"text-center py-4"},Ht=V({__name:"AnalyticsView",setup(Lt){W();const m=w(!1),i=w(null),b=w(),T=async()=>{try{m.value=!0;const e=await E.getDashboardStats();i.value=e,await N(),S()}catch(e){console.error("Failed to load analytics:",e)}finally{m.value=!1}},S=()=>{if(!b.value||!i.value?.sales_by_hour?.length)return;const e=b.value.getContext("2d");if(!e)return;e.clearRect(0,0,b.value.width,b.value.height);const t=i.value.sales_by_hour,h=b.value.width,l=b.value.height,d=60,A=h-d*2,g=l-d*2,p=Math.max(...t.map(a=>a.revenue));Math.max(...t.map(a=>a.orders_count)),e.strokeStyle="#e9ecef",e.lineWidth=1;for(let a=0;a<=5;a++){const r=d+g/5*a;e.beginPath(),e.moveTo(d,r),e.lineTo(h-d,r),e.stroke()}const x=A/(t.length-1);for(let a=0;a<t.length;a++){const r=d+x*a;e.beginPath(),e.moveTo(r,d),e.lineTo(r,l-d),e.stroke()}e.strokeStyle="#28a745",e.lineWidth=3,e.beginPath(),t.forEach((a,r)=>{const v=d+x*r,y=l-d-a.revenue/p*g;r===0?e.moveTo(v,y):e.lineTo(v,y)}),e.stroke(),t.forEach((a,r)=>{const v=d+x*r,y=l-d-a.revenue/p*g;e.fillStyle="#28a745",e.beginPath(),e.arc(v,y,4,0,Math.PI*2),e.fill()}),e.fillStyle="#6c757d",e.font="12px sans-serif",e.textAlign="center",t.forEach((a,r)=>{const v=d+x*r;e.fillText(`${a.hour}:00`,v,l-d+20)}),e.textAlign="right";for(let a=0;a<=5;a++){const r=d+g/5*a,v=p-p/5*a;e.fillText(u(v),d-10,r+4)}},j=e=>["bg-warning","bg-secondary","bg-light text-dark"][e]||"bg-light text-dark";return z(async()=>{await T()}),(e,t)=>{const h=P("router-link");return c(),n("div",I,[s("div",$,[s("div",q,[s("div",H,[s("nav",L,[s("ol",X,[s("li",G,[F(h,{to:"/dashboard",class:"text-decoration-none text-dark"},{default:M(()=>t[1]||(t[1]=[s("i",{class:"bi bi-house me-1"},null,-1),_(" Главная ")])),_:1,__:[1]})]),t[2]||(t[2]=s("li",{class:"breadcrumb-item active text-muted","aria-current":"page"},"Аналитика",-1))])]),s("div",J,[t[5]||(t[5]=s("div",{class:"col-md-8"},[s("h1",{class:"h2 mb-2 d-flex align-items-center"},[s("i",{class:"bi bi-graph-up me-2 text-primary"}),_(" Аналитика ")]),s("p",{class:"text-muted mb-0"}," Статистика и аналитика работы ресторана за сегодня ")],-1)),s("div",K,[s("div",O,[s("button",{onClick:t[0]||(t[0]=l=>T()),class:"btn btn-primary",disabled:m.value},[t[3]||(t[3]=s("i",{class:"bi bi-arrow-clockwise me-1"},null,-1)),_(" "+o(m.value?"Загрузка...":"Обновить"),1)],8,Q),s("button",{class:"btn btn-outline-secondary",disabled:m.value,title:"Экспорт отчета"},t[4]||(t[4]=[s("i",{class:"bi bi-download me-1"},null,-1),_(" Экспорт ")]),8,U)])])])])])]),s("div",Y,[m.value?(c(),n("div",Z,t[6]||(t[6]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Загрузка...")],-1),s("p",{class:"text-muted mt-2"},"Загрузка аналитики...",-1)]))):(c(),n("div",ss,[s("div",ts,[s("div",es,[s("div",is,[s("div",os,[s("div",as,[s("div",ls,[t[9]||(t[9]=s("div",{class:"stats-icon bg-primary bg-gradient rounded-3 me-3"},[s("i",{class:"bi bi-receipt text-white"})],-1)),s("div",ds,[t[8]||(t[8]=s("h6",{class:"card-title text-muted mb-1"},"Заказы сегодня",-1)),s("h3",ns,o(i.value?.orders?.today||0),1),s("small",cs,[t[7]||(t[7]=s("i",{class:"bi bi-arrow-up me-1"},null,-1)),_(" Всего: "+o(i.value?.orders?.total||0),1)])])])])])]),s("div",rs,[s("div",_s,[s("div",vs,[s("div",bs,[t[11]||(t[11]=s("div",{class:"stats-icon bg-success bg-gradient rounded-3 me-3"},[s("i",{class:"bi bi-currency-dollar text-white"})],-1)),s("div",ms,[t[10]||(t[10]=s("h6",{class:"card-title text-muted mb-1"},"Выручка сегодня",-1)),s("h3",us,o(f(u)(i.value?.orders?.revenue_today||0)),1),s("small",hs," Средний чек: "+o(f(u)(i.value?.orders?.average_order_value||0)),1)])])])])]),s("div",gs,[s("div",ps,[s("div",xs,[s("div",ys,[t[13]||(t[13]=s("div",{class:"stats-icon bg-warning bg-gradient rounded-3 me-3"},[s("i",{class:"bi bi-table text-white"})],-1)),s("div",fs,[t[12]||(t[12]=s("h6",{class:"card-title text-muted mb-1"},"Занятые столики",-1)),s("h3",ws,o(i.value?.tables?.occupied||0)+"/"+o(i.value?.tables?.total||0),1),s("small",ks," Оборачиваемость: "+o((i.value?.performance?.table_turnover_rate||0).toFixed(1)),1)])])])])]),s("div",Cs,[s("div",Ts,[s("div",Ss,[s("div",js,[t[15]||(t[15]=s("div",{class:"stats-icon bg-info bg-gradient rounded-3 me-3"},[s("i",{class:"bi bi-people text-white"})],-1)),s("div",As,[t[14]||(t[14]=s("h6",{class:"card-title text-muted mb-1"},"Активный персонал",-1)),s("h3",Vs,o((i.value?.users?.active_waiters||0)+(i.value?.users?.active_kitchen||0)),1),s("small",zs," Официанты: "+o(i.value?.users?.active_waiters||0)+" | Кухня: "+o(i.value?.users?.active_kitchen||0),1)])])])])])])]),s("div",Fs,[s("div",Ms,[t[17]||(t[17]=s("div",{class:"card-header bg-white border-0"},[s("h5",{class:"card-title mb-0"},[s("i",{class:"bi bi-graph-up me-2"}),_(" Продажи по часам ")])],-1)),s("div",Ps,[i.value?.sales_by_hour?.length?(c(),n("div",Bs,[s("canvas",{ref_key:"salesChart",ref:b,width:"800",height:"300"},null,512)])):(c(),n("div",Es,t[16]||(t[16]=[s("i",{class:"bi bi-graph-up text-muted",style:{"font-size":"2rem"}},null,-1),s("p",{class:"text-muted mt-2"},"Данные о продажах отсутствуют",-1)])))])])]),s("div",Ns,[s("div",Rs,[t[19]||(t[19]=s("div",{class:"card-header bg-white border-0"},[s("h5",{class:"card-title mb-0"},[s("i",{class:"bi bi-star me-2"}),_(" Популярные блюда ")])],-1)),s("div",Ws,[i.value?.top_dishes?.length?(c(),n("div",Ds,[(c(!0),n(k,null,C(i.value.top_dishes.slice(0,5),(l,d)=>(c(),n("div",{key:l.dish_id,class:"top-dish-item d-flex align-items-center mb-3"},[s("div",Is,[s("span",{class:R(["badge",j(d)])},o(d+1),3)]),s("div",$s,[s("h6",qs,o(l.dish_name),1),s("small",Hs,o(l.orders_count)+" заказов",1)]),s("div",Ls,[s("div",Xs,o(f(u)(l.revenue)),1)])]))),128))])):(c(),n("div",Gs,t[18]||(t[18]=[s("i",{class:"bi bi-star text-muted",style:{"font-size":"2rem"}},null,-1),s("p",{class:"text-muted mt-2"},"Данные о популярных блюдах отсутствуют",-1)])))])])]),s("div",Js,[s("div",Ks,[t[28]||(t[28]=s("div",{class:"card-header bg-white border-0"},[s("h5",{class:"card-title mb-0"},[s("i",{class:"bi bi-pie-chart me-2"}),_(" Статистика заказов ")])],-1)),s("div",Os,[s("div",Qs,[s("div",Us,[s("div",Ys,[s("div",Zs,o(i.value?.orders?.pending||0),1),t[20]||(t[20]=s("div",{class:"stat-label"},"В обработке",-1))])]),s("div",st,[s("div",tt,[s("div",et,o(i.value?.orders?.completed||0),1),t[21]||(t[21]=s("div",{class:"stat-label"},"Завершенных",-1))])]),s("div",it,[s("div",ot,[s("div",at,o(i.value?.orders?.cancelled||0),1),t[22]||(t[22]=s("div",{class:"stat-label"},"Отмененных",-1))])]),s("div",lt,[s("div",dt,[s("div",nt,o(i.value?.dishes?.available||0),1),t[23]||(t[23]=s("div",{class:"stat-label"},"Доступно блюд",-1))])])]),s("div",ct,[t[27]||(t[27]=s("h6",{class:"text-muted mb-3"},"Типы заказов",-1)),s("div",rt,[s("div",_t,[t[24]||(t[24]=s("span",null,[s("i",{class:"bi bi-house me-2"}),_("В зале")],-1)),s("span",vt,o(i.value?.orders_by_type?.dine_in||0),1)]),s("div",bt,[t[25]||(t[25]=s("span",null,[s("i",{class:"bi bi-bag me-2"}),_("На вынос")],-1)),s("span",mt,o(i.value?.orders_by_type?.takeaway||0),1)]),s("div",ut,[t[26]||(t[26]=s("span",null,[s("i",{class:"bi bi-truck me-2"}),_("Доставка")],-1)),s("span",ht,o(i.value?.orders_by_type?.delivery||0),1)])])])])])]),s("div",gt,[s("div",pt,[t[36]||(t[36]=s("div",{class:"card-header bg-white border-0"},[s("h5",{class:"card-title mb-0"},[s("i",{class:"bi bi-speedometer2 me-2"}),_(" Производительность ")])],-1)),s("div",xt,[s("div",yt,[s("div",ft,[s("div",wt,[t[29]||(t[29]=s("span",{class:"text-muted"},"Среднее время приготовления",-1)),s("span",kt,o(i.value?.performance?.average_cooking_time||0)+" мин",1)]),t[30]||(t[30]=s("div",{class:"progress mt-1",style:{height:"4px"}},[s("div",{class:"progress-bar bg-primary",style:{width:"75%"}})],-1))]),s("div",Ct,[s("div",Tt,[t[31]||(t[31]=s("span",{class:"text-muted"},"Среднее время обслуживания",-1)),s("span",St,o(i.value?.performance?.average_service_time||0)+" мин",1)]),t[32]||(t[32]=s("div",{class:"progress mt-1",style:{height:"4px"}},[s("div",{class:"progress-bar bg-success",style:{width:"60%"}})],-1))]),s("div",jt,[s("div",At,[t[33]||(t[33]=s("span",{class:"text-muted"},"Оборачиваемость столов",-1)),s("span",Vt,o((i.value?.performance?.table_turnover_rate||0).toFixed(1)),1)]),t[34]||(t[34]=s("div",{class:"progress mt-1",style:{height:"4px"}},[s("div",{class:"progress-bar bg-warning",style:{width:"45%"}})],-1))]),i.value?.performance?.peak_hours?.length?(c(),n("div",zt,[t[35]||(t[35]=s("h6",{class:"text-muted mb-2"},"Пиковые часы",-1)),s("div",Ft,[(c(!0),n(k,null,C(i.value.performance.peak_hours,l=>(c(),n("span",{key:l,class:"badge bg-light text-dark me-1 mb-1"},o(l)+":00 ",1))),128))])])):B("",!0)])])])]),s("div",Mt,[s("div",Pt,[t[38]||(t[38]=s("div",{class:"card-header bg-white border-0"},[s("h5",{class:"card-title mb-0"},[s("i",{class:"bi bi-credit-card me-2"}),_(" Способы оплаты ")])],-1)),s("div",Bt,[i.value?.payment_methods?.length?(c(),n("div",Et,[(c(!0),n(k,null,C(i.value.payment_methods,l=>(c(),n("div",{key:l.method_name,class:"col-lg-3 col-md-6"},[s("div",Nt,[s("div",Rt,[s("div",null,[s("h6",Wt,o(l.method_name),1),s("small",Dt,o(l.orders_count)+" заказов",1)]),s("div",It,[s("div",$t,o(f(u)(l.revenue)),1)])])])]))),128))])):(c(),n("div",qt,t[37]||(t[37]=[s("i",{class:"bi bi-credit-card text-muted",style:{"font-size":"2rem"}},null,-1),s("p",{class:"text-muted mt-2"},"Данные о способах оплаты отсутствуют",-1)])))])])])]))])])}}}),Gt=D(Ht,[["__scopeId","data-v-be054bdc"]]);export{Gt as default};

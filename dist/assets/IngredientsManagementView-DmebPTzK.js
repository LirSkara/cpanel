import{d as P,r as c,c as D,o as R,b as u,e as s,g as G,w as H,h as J,i as a,t as n,j as v,v as I,k as K,F as O,l as Q,m as W,n as T,f as X,p as b,s as A,q as m,_ as Y}from"./index-BRWVB6f9.js";const Z={class:"ingredients-page"},ss={class:"container-fluid py-4"},es={class:"card shadow-sm border-0 mb-4 p-3"},ts={class:"card-body"},ls={"aria-label":"breadcrumb",class:"mb-3"},os={class:"breadcrumb mb-0"},as={class:"breadcrumb-item"},ns={class:"row align-items-center"},is={class:"col-md-8"},ds={class:"text-muted mb-0"},rs={class:"badge bg-primary"},cs={class:"badge bg-danger"},us={class:"badge bg-success"},bs={class:"col-md-4 text-end"},ms=["disabled"],vs={class:"card mb-4"},ps={class:"card-body"},gs={class:"row g-3"},_s={class:"col-md-6"},ys={class:"input-group"},fs={class:"col-md-3"},hs={class:"col-md-3"},xs={class:"btn-group w-100",role:"group"},ws=["disabled"],ks={class:"btn-group",role:"group"},Cs=["disabled"],Is={class:"dropdown-menu"},As={class:"row mb-4"},Ms={class:"col-md-4"},Vs={class:"card"},Ss={class:"card-body text-center"},Bs={class:"card-title"},Ls={class:"col-md-4"},Us={class:"card"},$s={class:"card-body text-center"},Ds={class:"card-title"},Ts={class:"col-md-4"},qs={class:"card"},Ns={class:"card-body text-center"},Es={class:"card-title"},js={key:0,class:"text-center py-5"},Fs={key:1,class:"card"},zs={class:"card-body"},Ps={class:"table-responsive"},Rs={class:"table table-hover"},Gs={width:"50"},Hs={class:"form-check"},Js=["checked"],Ks={class:"form-check"},Os=["value"],Qs={class:"d-flex align-items-center"},Ws={class:"text-muted"},Xs={class:"text-muted"},Ys={class:"btn-group",role:"group"},Zs=["onClick"],se=["onClick","title"],ee=["onClick"],te={key:2,class:"text-center py-5"},le={class:"modal-dialog"},oe={class:"modal-content"},ae={class:"modal-header"},ne={class:"modal-title"},ie={class:"modal-body"},de={class:"mb-3"},re={class:"mb-3"},ce={class:"mb-3"},ue={class:"form-check"},be={class:"modal-footer"},me=["disabled"],ve={key:0,class:"spinner-border spinner-border-sm me-2"},pe=P({__name:"IngredientsManagementView",setup(ge){const M=t=>new Promise((e,C)=>{const l=()=>{window.bootstrap&&window.bootstrap.Modal?e(new window.bootstrap.Modal(t)):setTimeout(l,100)};l()}),i=c([]),r=c([]),o=c([]),p=c(""),y=c(""),f=c(!1),h=c(!1),g=c(!1),x=c(),d=c({name:"",description:null,is_allergen:!1}),V=D(()=>Array.isArray(i.value)?i.value.filter(t=>t.is_allergen).length:0),S=D(()=>Array.isArray(i.value)?i.value.filter(t=>!t.is_allergen).length:0),_=async()=>{try{f.value=!0;const t=await b.getIngredients();i.value=Array.isArray(t)?t:[],w()}catch(t){console.error("Ошибка загрузки ингредиентов:",t),i.value=[],w()}finally{f.value=!1}},w=()=>{if(!Array.isArray(i.value)){r.value=[];return}let t=i.value;p.value&&(t=t.filter(e=>e.name.toLowerCase().includes(p.value.toLowerCase())||e.description&&e.description.toLowerCase().includes(p.value.toLowerCase()))),y.value==="allergen"?t=t.filter(e=>e.is_allergen):y.value==="normal"&&(t=t.filter(e=>!e.is_allergen)),r.value=t},B=async()=>{g.value=!1,d.value={name:"",description:null,is_allergen:!1},(await M(x.value)).show()},q=async t=>{g.value=!0,d.value={...t},(await M(x.value)).show()},L=async()=>{try{h.value=!0,g.value?await b.updateIngredient(d.value.id,d.value):await b.createIngredient(d.value);const t=x.value,e=window.bootstrap?.Modal?.getInstance(t);e?e.hide():t.querySelector('[data-bs-dismiss="modal"]')?.click(),await _()}catch(t){console.error("Ошибка сохранения ингредиента:",t)}finally{h.value=!1}},N=async t=>{if(confirm(`Вы уверены, что хотите удалить ингредиент "${t.name}"?`))try{await b.deleteIngredient(t.id),await _()}catch(e){console.error("Ошибка удаления ингредиента:",e)}},E=async t=>{try{await b.updateIngredient(t.id,{is_allergen:!t.is_allergen}),t.is_allergen=!t.is_allergen}catch(e){console.error("Ошибка изменения статуса аллергена:",e)}},U=()=>{Array.isArray(r.value)?o.value=r.value.map(t=>t.id):o.value=[]},j=()=>{o.value.length===r.value.length?o.value=[]:U()},$=async t=>{try{for(const e of o.value)await b.updateIngredient(e,{is_allergen:t});o.value=[],await _()}catch(e){console.error("Ошибка массового изменения статуса аллергена:",e)}},F=async()=>{if(confirm(`Вы уверены, что хотите удалить ${o.value.length} ингредиентов?`))try{for(const t of o.value)await b.deleteIngredient(t);o.value=[],await _()}catch(t){console.error("Ошибка массового удаления:",t)}},z=t=>new Date(t).toLocaleDateString("ru-RU");return R(async()=>{await _()}),(t,e)=>{const C=J("router-link");return m(),u("div",Z,[s("div",ss,[s("div",es,[s("div",ts,[s("nav",ls,[s("ol",os,[s("li",as,[G(C,{to:"/dashboard",class:"text-decoration-none text-dark"},{default:H(()=>e[8]||(e[8]=[s("i",{class:"bi bi-house me-1"},null,-1),a(" Главная ")])),_:1,__:[8]})]),e[9]||(e[9]=s("li",{class:"breadcrumb-item active text-muted","aria-current":"page"},"Управление ингредиентами",-1))])]),s("div",ns,[s("div",is,[e[13]||(e[13]=s("h1",{class:"h2 mb-2 d-flex align-items-center"},[s("i",{class:"bi bi-list-ul me-2 text-primary"}),a(" Управление ингредиентами ")],-1)),s("p",ds,[e[10]||(e[10]=a(" Всего ингредиентов: ")),s("span",rs,n(Array.isArray(i.value)?i.value.length:0),1),e[11]||(e[11]=a(" • Аллергенов: ")),s("span",cs,n(V.value),1),e[12]||(e[12]=a(" • Обычных: ")),s("span",us,n(S.value),1)])]),s("div",bs,[s("button",{onClick:B,class:"btn btn-primary",disabled:f.value},e[14]||(e[14]=[s("i",{class:"bi bi-plus-circle me-1"},null,-1),a(" Добавить ингредиент ")]),8,ms)])])])]),s("div",vs,[s("div",ps,[s("div",gs,[s("div",_s,[s("div",ys,[e[15]||(e[15]=s("span",{class:"input-group-text"},[s("i",{class:"bi bi-search"})],-1)),v(s("input",{type:"text",class:"form-control",placeholder:"Поиск ингредиентов...","onUpdate:modelValue":e[0]||(e[0]=l=>p.value=l),onInput:w},null,544),[[I,p.value]])])]),s("div",fs,[v(s("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=l=>y.value=l),onChange:w},e[16]||(e[16]=[s("option",{value:""},"Все ингредиенты",-1),s("option",{value:"allergen"},"Только аллергены",-1),s("option",{value:"normal"},"Обычные ингредиенты",-1)]),544),[[K,y.value]])]),s("div",hs,[s("div",xs,[s("button",{class:"btn btn-outline-primary",onClick:U,disabled:r.value.length===0},e[17]||(e[17]=[s("i",{class:"bi bi-check-square"},null,-1),a(" Выбрать все ")]),8,ws),s("div",ks,[s("button",{class:"btn btn-outline-secondary dropdown-toggle","data-bs-toggle":"dropdown",disabled:o.value.length===0}," Действия ("+n(o.value.length)+") ",9,Cs),s("ul",Is,[s("li",null,[s("a",{class:"dropdown-item",href:"#",onClick:e[2]||(e[2]=l=>$(!0))},e[18]||(e[18]=[s("i",{class:"bi bi-exclamation-triangle text-danger"},null,-1),a(" Отметить как аллергены ")]))]),s("li",null,[s("a",{class:"dropdown-item",href:"#",onClick:e[3]||(e[3]=l=>$(!1))},e[19]||(e[19]=[s("i",{class:"bi bi-check-circle text-success"},null,-1),a(" Убрать статус аллергена ")]))]),e[21]||(e[21]=s("li",null,[s("hr",{class:"dropdown-divider"})],-1)),s("li",null,[s("a",{class:"dropdown-item text-danger",href:"#",onClick:F},e[20]||(e[20]=[s("i",{class:"bi bi-trash"},null,-1),a(" Удалить выбранные ")]))])])])])])])])]),s("div",As,[s("div",Ms,[s("div",Vs,[s("div",Ss,[e[22]||(e[22]=s("i",{class:"bi bi-list-ul display-6 text-primary mb-2"},null,-1)),s("h5",Bs,n(Array.isArray(i.value)?i.value.length:0),1),e[23]||(e[23]=s("p",{class:"card-text text-muted"},"Всего ингредиентов",-1))])])]),s("div",Ls,[s("div",Us,[s("div",$s,[e[24]||(e[24]=s("i",{class:"bi bi-exclamation-triangle display-6 text-danger mb-2"},null,-1)),s("h5",Ds,n(V.value),1),e[25]||(e[25]=s("p",{class:"card-text text-muted"},"Аллергенов",-1))])])]),s("div",Ts,[s("div",qs,[s("div",Ns,[e[26]||(e[26]=s("i",{class:"bi bi-check-circle display-6 text-success mb-2"},null,-1)),s("h5",Es,n(S.value),1),e[27]||(e[27]=s("p",{class:"card-text text-muted"},"Обычных",-1))])])])]),f.value?(m(),u("div",js,e[28]||(e[28]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Загрузка...")],-1),s("p",{class:"mt-3 text-muted"},"Загрузка ингредиентов...",-1)]))):r.value.length>0?(m(),u("div",Fs,[e[37]||(e[37]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},"Список ингредиентов")],-1)),s("div",zs,[s("div",Ps,[s("table",Rs,[s("thead",null,[s("tr",null,[s("th",Gs,[s("div",Hs,[s("input",{class:"form-check-input",type:"checkbox",checked:o.value.length===r.value.length&&r.value.length>0,onChange:j},null,40,Js)])]),e[29]||(e[29]=s("th",null,"Название",-1)),e[30]||(e[30]=s("th",null,"Описание",-1)),e[31]||(e[31]=s("th",null,"Статус",-1)),e[32]||(e[32]=s("th",null,"Дата создания",-1)),e[33]||(e[33]=s("th",{width:"200"},"Действия",-1))])]),s("tbody",null,[(m(!0),u(O,null,Q(r.value,l=>(m(),u("tr",{key:l.id},[s("td",null,[s("div",Ks,[v(s("input",{class:"form-check-input",type:"checkbox",value:l.id,"onUpdate:modelValue":e[4]||(e[4]=k=>o.value=k)},null,8,Os),[[T,o.value]])])]),s("td",null,[s("div",Qs,[e[34]||(e[34]=s("i",{class:"bi bi-list-ul me-2 text-muted"},null,-1)),s("strong",null,n(l.name),1)])]),s("td",null,[s("span",Ws,n(l.description||"Без описания"),1)]),s("td",null,[s("span",{class:A(["badge",l.is_allergen?"bg-danger":"bg-success"])},[s("i",{class:A(["bi",l.is_allergen?"bi-exclamation-triangle":"bi-check-circle"])},null,2),a(" "+n(l.is_allergen?"Аллерген":"Обычный"),1)],2)]),s("td",null,[s("small",Xs,n(z(l.created_at)),1)]),s("td",null,[s("div",Ys,[s("button",{class:"btn btn-outline-primary btn-sm",onClick:k=>q(l),title:"Редактировать"},e[35]||(e[35]=[s("i",{class:"bi bi-pencil"},null,-1)]),8,Zs),s("button",{class:"btn btn-outline-secondary btn-sm",onClick:k=>E(l),title:l.is_allergen?"Убрать статус аллергена":"Отметить как аллерген"},[s("i",{class:A(["bi",l.is_allergen?"bi-check-circle":"bi-exclamation-triangle"])},null,2)],8,se),s("button",{class:"btn btn-outline-danger btn-sm",onClick:k=>N(l),title:"Удалить"},e[36]||(e[36]=[s("i",{class:"bi bi-trash"},null,-1)]),8,ee)])])]))),128))])])])])])):(m(),u("div",te,[e[39]||(e[39]=s("i",{class:"bi bi-list-ul display-1 text-muted mb-3"},null,-1)),e[40]||(e[40]=s("h4",{class:"text-muted"},"Ингредиенты не найдены",-1)),e[41]||(e[41]=s("p",{class:"text-muted"},"Измените параметры поиска или добавьте новый ингредиент",-1)),s("button",{class:"btn btn-primary",onClick:B},e[38]||(e[38]=[s("i",{class:"bi bi-plus-circle"},null,-1),a(" Добавить ингредиент ")]))]))]),s("div",{class:"modal fade",id:"ingredientModal",tabindex:"-1",ref_key:"ingredientModal",ref:x},[s("div",le,[s("div",oe,[s("div",ae,[s("h5",ne,n(g.value?"Редактирование ингредиента":"Создание нового ингредиента"),1),e[42]||(e[42]=s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1))]),s("div",ie,[s("form",{onSubmit:W(L,["prevent"])},[s("div",de,[e[43]||(e[43]=s("label",{class:"form-label"},"Название *",-1)),v(s("input",{type:"text",class:"form-control","onUpdate:modelValue":e[5]||(e[5]=l=>d.value.name=l),required:"",maxlength:"255"},null,512),[[I,d.value.name]])]),s("div",re,[e[44]||(e[44]=s("label",{class:"form-label"},"Описание",-1)),v(s("textarea",{class:"form-control","onUpdate:modelValue":e[6]||(e[6]=l=>d.value.description=l),rows:"3",maxlength:"500"},null,512),[[I,d.value.description]])]),s("div",ce,[s("div",ue,[v(s("input",{class:"form-check-input",type:"checkbox",id:"is_allergen","onUpdate:modelValue":e[7]||(e[7]=l=>d.value.is_allergen=l)},null,512),[[T,d.value.is_allergen]]),e[45]||(e[45]=s("label",{class:"form-check-label",for:"is_allergen"},[s("i",{class:"bi bi-exclamation-triangle text-danger me-1"}),a(" Является аллергеном ")],-1))]),e[46]||(e[46]=s("small",{class:"text-muted"},"Отметьте, если ингредиент может вызвать аллергическую реакцию",-1))])],32)]),s("div",be,[e[47]||(e[47]=s("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," Отмена ",-1)),s("button",{type:"button",class:"btn btn-primary",onClick:L,disabled:h.value},[h.value?(m(),u("span",ve)):X("",!0),a(" "+n(g.value?"Сохранить изменения":"Создать ингредиент"),1)],8,me)])])])],512)])}}}),ye=Y(pe,[["__scopeId","data-v-b657a083"]]);export{ye as default};

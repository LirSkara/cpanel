import{d as st,u as lt,r as d,c as I,o as at,a as ot,b as r,e as t,f as p,g as it,w as nt,h as dt,i as o,t as n,j as h,k as rt,F as ct,l as ut,m as C,v as q,n as j,s as P,p as v,q as c,_ as vt}from"./index-BRWVB6f9.js";const mt={class:"payment-methods-page"},bt={class:"container-fluid py-4"},yt={class:"card shadow-sm border-0 mb-4 p-3"},pt={class:"card-body"},_t={"aria-label":"breadcrumb",class:"mb-3"},gt={class:"breadcrumb mb-0"},ft={class:"breadcrumb-item"},ht={class:"row align-items-center"},kt={class:"col-md-8"},wt={class:"text-muted mb-0"},xt={class:"badge bg-primary"},Mt={class:"badge bg-success"},Ct={class:"badge bg-warning"},Pt={class:"col-md-4 text-end"},At={class:"btn-group"},$t=["disabled"],St=["disabled"],Vt={class:"container-fluid"},Ft={class:"row"},Dt={class:"col-12"},Et={class:"card shadow-sm border-0"},Ut={class:"card-header bg-white"},It={class:"row align-items-center"},jt={class:"col-md-8"},Bt={class:"d-flex gap-2 align-items-center"},Nt={key:0,class:"btn-group btn-group-sm"},qt=["title"],Lt=["title"],zt=["title"],Rt={class:"d-flex gap-2 ms-auto"},Tt=["disabled"],Gt={class:"card-body"},Ht={key:0,class:"text-center py-5"},Jt={key:1,class:"text-center py-5"},Kt={key:2,class:"row"},Ot={class:"card-header d-flex justify-content-between align-items-center py-2"},Qt={class:"d-flex align-items-center"},Wt={class:"form-check me-2"},Xt=["id","value"],Yt={class:"fs-6"},Zt={class:"card-body py-2"},te={class:"row g-2 mb-2"},ee={class:"col-6"},se={class:"info-item-compact"},le={class:"text-truncate"},ae={class:"col-6"},oe={class:"info-item-compact"},ie={class:"text-truncate"},ne={class:"card-footer bg-transparent border-top-0 py-2"},de={class:"d-flex gap-1 flex-wrap"},re=["onClick","title"],ce=["onClick","title"],ue={class:"dropdown"},ve={class:"dropdown-menu dropdown-menu-end"},me=["onClick"],be=["onClick"],ye={class:"modal-content"},pe={class:"modal-body"},_e={key:0,class:"alert alert-danger",role:"alert"},ge={class:"mb-0"},fe={class:"row g-3"},he={class:"col-12"},ke={class:"col-12"},we={class:"form-check"},xe={class:"d-flex justify-content-end gap-2 mt-4"},Me=["disabled"],Ce={class:"modal-content"},Pe={class:"modal-body"},Ae={key:0,class:"alert alert-danger",role:"alert"},$e={class:"mb-0"},Se={class:"row g-3"},Ve={class:"col-12"},Fe={class:"col-12"},De={class:"form-check"},Ee={class:"d-flex justify-content-end gap-2 mt-4"},Ue=["disabled"],Ie={class:"modal-content"},je={class:"modal-header"},Be={class:"modal-title"},Ne={class:"modal-body"},qe={key:0,class:"row g-3"},Le={class:"col-md-6"},ze={class:"card"},Re={class:"card-body"},Te={class:"row"},Ge={class:"col-sm-8"},He={class:"col-sm-8"},Je={class:"col-sm-8"},Ke={class:"col-md-6"},Oe={class:"card"},Qe={class:"card-body"},We={class:"row"},Xe={class:"col-sm-8"},Ye={class:"col-sm-8"},Ze=st({__name:"PaymentMethodsManagementView",setup(ts){const L=ot(),z=lt(),a=d([]),m=d(!1),k=d(""),A=d(!1),E=d(!1),U=d(!1),_=d({name:"",is_active:!0}),$=d(!1),g=d(""),b=d({}),w=d(null),S=d(!1),f=d(""),u=d(null),i=d([]),R=I(()=>Array.isArray(a.value)?a.value.filter(s=>s.is_active).length:0),T=I(()=>Array.isArray(a.value)?a.value.filter(s=>!s.is_active).length:0),G=I(()=>Array.isArray(a.value)?a.value.filter(s=>!k.value||k.value==="active"&&s.is_active||k.value==="inactive"&&!s.is_active):[]),V=s=>new Date(s).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),B=s=>s?"bg-success":"bg-secondary",H=s=>s.is_active?"method-active":"method-inactive",x=async()=>{try{m.value=!0,console.log("Loading payment methods...");const s=await v.getPaymentMethods();console.log("Payment methods loaded:",s),a.value=s.payment_methods||s,console.log("Payment methods set:",a.value)}catch(s){console.error("Failed to load payment methods:",s),a.value=[]}finally{m.value=!1}},J=async()=>{try{m.value=!0;const s=await v.getActivePaymentMethods();a.value=s.payment_methods||s}catch(s){console.error("Failed to load active payment methods:",s),a.value=[]}finally{m.value=!1}},F=()=>{A.value=!1,g.value="",_.value={name:"",is_active:!0}},K=async()=>{try{$.value=!0,g.value="";const s=await v.createPaymentMethod(_.value);Array.isArray(a.value)?a.value.push(s):a.value=[s],F()}catch(s){console.error("Failed to create payment method:",s),s instanceof Error?g.value=s.message:g.value="Произошла неизвестная ошибка"}finally{$.value=!1}},O=s=>{w.value=s.id,b.value={name:s.name,is_active:s.is_active},E.value=!0},D=()=>{E.value=!1,f.value="",b.value={},w.value=null},Q=async()=>{if(!(!w.value||!Array.isArray(a.value)))try{S.value=!0,f.value="";const s=await v.updatePaymentMethod(w.value,b.value),e=a.value.findIndex(M=>M.id===w.value);e!==-1&&(a.value[e]=s),D()}catch(s){console.error("Failed to update payment method:",s),s instanceof Error?f.value=s.message:f.value="Произошла неизвестная ошибка"}finally{S.value=!1}},W=s=>{u.value=s,U.value=!0},N=()=>{U.value=!1,u.value=null},X=async s=>{if(Array.isArray(a.value))try{const e=!s.is_active,M=await v.updatePaymentMethod(s.id,{is_active:e}),l=a.value.findIndex(y=>y.id===s.id);l!==-1&&(a.value[l]=M)}catch(e){console.error("Failed to toggle payment method status:",e)}},Y=async s=>{if(Array.isArray(a.value)&&confirm(`Вы уверены, что хотите удалить способ оплаты "${s.name}"?`))try{await v.deletePaymentMethod(s.id),a.value=a.value.filter(e=>e.id!==s.id)}catch(e){console.error("Failed to delete payment method:",e)}},Z=async()=>{if(i.value.length&&confirm(`Вы уверены, что хотите активировать ${i.value.length} способов оплаты?`))try{const s=i.value.map(e=>v.updatePaymentMethod(e,{is_active:!0}));await Promise.all(s),await x(),i.value=[]}catch(s){console.error("Failed to bulk activate payment methods:",s),alert("Ошибка при активации способов оплаты")}},tt=async()=>{if(i.value.length&&confirm(`Вы уверены, что хотите деактивировать ${i.value.length} способов оплаты?`))try{const s=i.value.map(e=>v.updatePaymentMethod(e,{is_active:!1}));await Promise.all(s),await x(),i.value=[]}catch(s){console.error("Failed to bulk deactivate payment methods:",s),alert("Ошибка при деактивации способов оплаты")}},et=async()=>{if(i.value.length&&confirm(`Вы уверены, что хотите удалить ${i.value.length} способов оплаты? Это действие нельзя отменить.`))try{const s=i.value.map(e=>v.deletePaymentMethod(e));await Promise.all(s),await x(),i.value=[]}catch(s){console.error("Failed to bulk delete payment methods:",s),alert("Ошибка при удалении способов оплаты")}};return at(async()=>{if(!z.isAuthenticated){L.push("/login");return}await x()}),(s,e)=>{const M=dt("router-link");return c(),r("div",mt,[t("div",bt,[t("div",yt,[t("div",pt,[t("nav",_t,[t("ol",gt,[t("li",ft,[it(M,{to:"/dashboard",class:"text-decoration-none text-dark"},{default:nt(()=>e[11]||(e[11]=[t("i",{class:"bi bi-house me-1"},null,-1),o(" Главная ")])),_:1,__:[11]})]),e[12]||(e[12]=t("li",{class:"breadcrumb-item active text-muted","aria-current":"page"},"Управление способами оплаты",-1))])]),t("div",ht,[t("div",kt,[e[16]||(e[16]=t("h1",{class:"h2 mb-2 d-flex align-items-center"},[t("i",{class:"bi bi-credit-card me-2 text-primary"}),o(" Управление способами оплаты ")],-1)),t("p",wt,[e[13]||(e[13]=o(" Всего способов оплаты: ")),t("span",xt,n(Array.isArray(a.value)?a.value.length:0),1),e[14]||(e[14]=o(" • Активных: ")),t("span",Mt,n(R.value),1),e[15]||(e[15]=o(" • Неактивных: ")),t("span",Ct,n(T.value),1)])]),t("div",Pt,[t("div",At,[t("button",{onClick:e[0]||(e[0]=l=>A.value=!0),class:"btn btn-primary",disabled:m.value},e[17]||(e[17]=[t("i",{class:"bi bi-plus-circle me-1"},null,-1),o(" Добавить способ оплаты ")]),8,$t),t("button",{onClick:J,class:"btn btn-outline-info",disabled:m.value,title:"Показать только активные"},e[18]||(e[18]=[t("i",{class:"bi bi-check-circle me-1"},null,-1),o(" Активные ")]),8,St)])])])])])]),t("div",Vt,[t("div",Ft,[t("div",Dt,[t("div",Et,[t("div",Ut,[t("div",It,[e[24]||(e[24]=t("div",{class:"col-md-4"},[t("h5",{class:"mb-0"},[t("i",{class:"bi bi-credit-card me-2"}),o(" Список способов оплаты ")])],-1)),t("div",jt,[t("div",Bt,[i.value.length>0?(c(),r("div",Nt,[t("button",{class:"btn btn-outline-primary",onClick:Z,title:`Активировать ${i.value.length} способов оплаты`},[e[19]||(e[19]=t("i",{class:"bi bi-check-circle me-1"},null,-1)),o(" Активировать ("+n(i.value.length)+") ",1)],8,qt),t("button",{class:"btn btn-outline-secondary",onClick:tt,title:`Деактивировать ${i.value.length} способов оплаты`},[e[20]||(e[20]=t("i",{class:"bi bi-x-circle me-1"},null,-1)),o(" Деактивировать ("+n(i.value.length)+") ",1)],8,Lt),t("button",{class:"btn btn-outline-danger",onClick:et,title:`Удалить ${i.value.length} способов оплаты`},[e[21]||(e[21]=t("i",{class:"bi bi-trash me-1"},null,-1)),o(" Удалить ("+n(i.value.length)+") ",1)],8,zt)])):p("",!0),t("div",Rt,[h(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>k.value=l),class:"form-select form-select-sm"},e[22]||(e[22]=[t("option",{value:""},"Все статусы",-1),t("option",{value:"active"},"Активные",-1),t("option",{value:"inactive"},"Неактивные",-1)]),512),[[rt,k.value]]),t("button",{class:"btn btn-outline-secondary btn-sm",onClick:x,disabled:m.value,title:"Обновить данные"},e[23]||(e[23]=[t("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),o(" Обновить ")]),8,Tt)])])])])]),t("div",Gt,[m.value?(c(),r("div",Ht,e[25]||(e[25]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Загрузка...")],-1),t("p",{class:"text-muted mt-2"},"Загрузка способов оплаты...",-1)]))):!Array.isArray(a.value)||a.value.length===0?(c(),r("div",Jt,[e[27]||(e[27]=t("i",{class:"bi bi-credit-card text-muted",style:{"font-size":"3rem"}},null,-1)),e[28]||(e[28]=t("p",{class:"text-muted mt-3"},"Способы оплаты не найдены",-1)),t("button",{onClick:e[2]||(e[2]=l=>A.value=!0),class:"btn btn-primary"},e[26]||(e[26]=[t("i",{class:"bi bi-plus-circle me-1"},null,-1),o(" Добавить первый способ оплаты ")]))])):(c(),r("div",Kt,[(c(!0),r(ct,null,ut(G.value,l=>(c(),r("div",{key:l.id,class:"col-lg-4 col-md-6 mb-3"},[t("div",{class:P(["card border-0 shadow-sm payment-method-card",H(l)])},[t("div",Ot,[t("div",Qt,[t("div",Wt,[h(t("input",{class:"form-check-input",type:"checkbox",id:`method-${l.id}`,"onUpdate:modelValue":e[3]||(e[3]=y=>i.value=y),value:l.id},null,8,Xt),[[j,i.value]])]),e[29]||(e[29]=t("div",{class:"payment-method-icon me-2"},[t("i",{class:"bi bi-credit-card text-primary"})],-1)),t("strong",Yt,n(l.name),1)]),t("span",{class:P(["badge badge-sm",B(l.is_active)])},n(l.is_active?"Активен":"Неактивен"),3)]),t("div",Zt,[t("div",te,[t("div",ee,[t("div",se,[e[30]||(e[30]=t("i",{class:"bi bi-calendar-plus text-success me-1"},null,-1)),t("small",le,n(V(l.created_at)),1)])]),t("div",ae,[t("div",oe,[e[31]||(e[31]=t("i",{class:"bi bi-clock text-info me-1"},null,-1)),t("small",ie,n(V(l.updated_at)),1)])])])]),t("div",ne,[t("div",de,[t("button",{class:"btn btn-sm btn-outline-secondary flex-fill",onClick:y=>O(l),title:"Редактировать способ оплаты "+l.name},e[32]||(e[32]=[t("i",{class:"bi bi-pencil"},null,-1)]),8,re),t("button",{class:P(["btn btn-sm flex-fill",l.is_active?"btn-outline-warning":"btn-outline-success"]),onClick:y=>X(l),title:l.is_active?"Деактивировать способ оплаты":"Активировать способ оплаты"},[t("i",{class:P(["bi",l.is_active?"bi-toggle-off":"bi-toggle-on"])},null,2)],10,ce),t("div",ue,[e[36]||(e[36]=t("button",{class:"btn btn-sm btn-outline-secondary dropdown-toggle-split",type:"button","data-bs-toggle":"dropdown",title:"Дополнительные действия"},[t("i",{class:"bi bi-three-dots"})],-1)),t("ul",ve,[t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:y=>W(l)},e[33]||(e[33]=[t("i",{class:"bi bi-eye me-2"},null,-1),o(" Просмотреть детали ")]),8,me)]),e[35]||(e[35]=t("li",null,[t("hr",{class:"dropdown-divider"})],-1)),t("li",null,[t("a",{class:"dropdown-item text-danger",href:"#",onClick:y=>Y(l)},e[34]||(e[34]=[t("i",{class:"bi bi-trash me-2"},null,-1),o(" Удалить ")]),8,be)])])])])])],2)]))),128))]))])])])])]),A.value?(c(),r("div",{key:0,class:"modal fade show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"},onClick:F},[t("div",{class:"modal-dialog modal-dialog-centered modal-lg",onClick:e[6]||(e[6]=C(()=>{},["stop"]))},[t("div",ye,[t("div",{class:"modal-header"},[e[37]||(e[37]=t("h5",{class:"modal-title"},[t("i",{class:"bi bi-plus-circle me-2"}),o(" Добавить способ оплаты ")],-1)),t("button",{type:"button",class:"btn-close",onClick:F})]),t("div",pe,[g.value?(c(),r("div",_e,[t("pre",ge,n(g.value),1)])):p("",!0),t("form",{onSubmit:C(K,["prevent"])},[t("div",fe,[t("div",he,[e[38]||(e[38]=t("label",{class:"form-label"},"Название способа оплаты",-1)),h(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>_.value.name=l),type:"text",class:"form-control",required:"",placeholder:"Например: Наличные, Карта, Онлайн оплата"},null,512),[[q,_.value.name]])]),t("div",ke,[t("div",we,[h(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>_.value.is_active=l),class:"form-check-input",type:"checkbox",id:"createActive"},null,512),[[j,_.value.is_active]]),e[39]||(e[39]=t("label",{class:"form-check-label",for:"createActive"}," Активен ",-1))])])]),t("div",xe,[t("button",{type:"button",onClick:F,class:"btn btn-secondary"}," Отмена "),t("button",{type:"submit",class:"btn btn-primary",disabled:$.value},[e[40]||(e[40]=t("i",{class:"bi bi-plus-circle me-1"},null,-1)),o(" "+n($.value?"Создание...":"Создать"),1)],8,Me)])],32)])])])])):p("",!0),E.value?(c(),r("div",{key:1,class:"modal fade show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"},onClick:D},[t("div",{class:"modal-dialog modal-dialog-centered modal-lg",onClick:e[9]||(e[9]=C(()=>{},["stop"]))},[t("div",Ce,[t("div",{class:"modal-header"},[e[41]||(e[41]=t("h5",{class:"modal-title"},[t("i",{class:"bi bi-pencil me-2"}),o(" Редактировать способ оплаты ")],-1)),t("button",{type:"button",class:"btn-close",onClick:D})]),t("div",Pe,[f.value?(c(),r("div",Ae,[t("pre",$e,n(f.value),1)])):p("",!0),t("form",{onSubmit:C(Q,["prevent"])},[t("div",Se,[t("div",Ve,[e[42]||(e[42]=t("label",{class:"form-label"},"Название способа оплаты",-1)),h(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>b.value.name=l),type:"text",class:"form-control",required:""},null,512),[[q,b.value.name]])]),t("div",Fe,[t("div",De,[h(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>b.value.is_active=l),class:"form-check-input",type:"checkbox",id:"editActive"},null,512),[[j,b.value.is_active]]),e[43]||(e[43]=t("label",{class:"form-check-label",for:"editActive"}," Активен ",-1))])])]),t("div",Ee,[t("button",{type:"button",onClick:D,class:"btn btn-secondary"}," Отмена "),t("button",{type:"submit",class:"btn btn-primary",disabled:S.value},[e[44]||(e[44]=t("i",{class:"bi bi-check-circle me-1"},null,-1)),o(" "+n(S.value?"Сохранение...":"Сохранить"),1)],8,Ue)])],32)])])])])):p("",!0),U.value?(c(),r("div",{key:2,class:"modal fade show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.5)"},onClick:N},[t("div",{class:"modal-dialog modal-dialog-centered modal-lg",onClick:e[10]||(e[10]=C(()=>{},["stop"]))},[t("div",Ie,[t("div",je,[t("h5",Be,[e[45]||(e[45]=t("i",{class:"bi bi-eye me-2"},null,-1)),o(' Детали способа оплаты "'+n(u.value?.name)+'" ',1)]),t("button",{type:"button",class:"btn-close",onClick:N})]),t("div",Ne,[u.value?(c(),r("div",qe,[t("div",Le,[t("div",ze,[t("div",Re,[e[49]||(e[49]=t("h6",{class:"card-title"},[t("i",{class:"bi bi-info-circle me-2"}),o(" Основная информация ")],-1)),t("dl",Te,[e[46]||(e[46]=t("dt",{class:"col-sm-4"},"ID:",-1)),t("dd",Ge,n(u.value.id),1),e[47]||(e[47]=t("dt",{class:"col-sm-4"},"Название:",-1)),t("dd",He,n(u.value.name),1),e[48]||(e[48]=t("dt",{class:"col-sm-4"},"Статус:",-1)),t("dd",Je,[t("span",{class:P(["badge",B(u.value.is_active)])},n(u.value.is_active?"Активен":"Неактивен"),3)])])])])]),t("div",Ke,[t("div",Oe,[t("div",Qe,[e[52]||(e[52]=t("h6",{class:"card-title"},[t("i",{class:"bi bi-clock me-2"}),o(" Временные метки ")],-1)),t("dl",We,[e[50]||(e[50]=t("dt",{class:"col-sm-4"},"Создано:",-1)),t("dd",Xe,n(V(u.value.created_at)),1),e[51]||(e[51]=t("dt",{class:"col-sm-4"},"Изменено:",-1)),t("dd",Ye,n(V(u.value.updated_at)),1)])])])])])):p("",!0)])])])])):p("",!0)])}}}),ss=vt(Ze,[["__scopeId","data-v-04e51a2c"]]);export{ss as default};
